<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule Management System - Professional Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            color: #333;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 8px;
            font-size: 1.8rem;
            font-weight: 600;
        }

        .header p {
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-bottom: 0;
        }

        /* Navigation Menu Styles */
        .navigation-menu {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 15px;
        }

        .nav-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
            background: linear-gradient(135deg, #2980b9, #3498db);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #27ae60, #229954);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .nav-btn.active:hover {
            background: linear-gradient(135deg, #229954, #27ae60);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }

        /* Section Visibility */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Patient Queue Styles */
        .queue-filter-btn {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            color: #666;
            transition: all 0.2s ease;
        }

        .queue-filter-btn:hover {
            background: #e9ecef;
            border-color: #3498db;
        }

        .queue-filter-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .patient-queue {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }

        .queue-item {
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }

        .queue-item:hover {
            background: #f8f9fa;
        }

        .queue-item:last-child {
            border-bottom: none;
        }

        .patient-info {
            flex: 1;
        }

        .patient-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .patient-details {
            font-size: 0.75rem;
            color: #666;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .patient-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .status-scheduled {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status-waiting {
            background: #fff3e0;
            color: #f57c00;
        }

        .status-urgent {
            background: #ffebee;
            color: #d32f2f;
            animation: pulse 2s infinite;
        }

        .status-completed {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .wait-time {
            font-size: 0.75rem;
            color: #666;
            font-weight: 500;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* Animated Counters */
        .counter {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #3498db, #2980b9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: counterGlow 2s ease-in-out infinite alternate;
        }

        @keyframes counterGlow {
            from { filter: brightness(1); }
            to { filter: brightness(1.2); }
        }

        /* Progress Bars */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            border-radius: 4px;
            transition: width 1s ease-in-out;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShimmer 2s infinite;
        }

        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Floating Action Buttons */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 25px rgba(231, 76, 60, 0.4);
        }

        .fab:active {
            transform: scale(0.95);
        }

        /* Live Status Indicators */
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            animation: statusPulse 2s infinite;
        }

        .status-indicator.active {
            background: #27ae60;
        }

        .status-indicator.warning {
            background: #f39c12;
        }

        .status-indicator.danger {
            background: #e74c3c;
        }

        @keyframes statusPulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* Notification Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left: 4px solid #27ae60;
        }

        .toast.warning {
            border-left: 4px solid #f39c12;
        }

        .toast.error {
            border-left: 4px solid #e74c3c;
        }

        /* Business Day Calendar Styles */
        .business-day-calendar {
            position: relative;
        }

        .business-day-calendar::after {
            content: 'üìÖ Business Days Only (Mon-Fri, No Holidays)';
            position: absolute;
            top: -25px;
            right: 0;
            font-size: 0.8rem;
            color: #666;
            font-weight: 500;
        }

        .weekend-warning {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            color: #856404;
            font-size: 0.9rem;
            display: none;
        }

        .weekend-warning.show {
            display: block;
        }

        .weekend-warning::before {
            content: '‚ö†Ô∏è ';
            font-size: 1.1rem;
        }

        /* Date Suggestions Styles */
        .date-suggestions {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .date-suggestions h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .suggested-dates {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
        }

        .suggested-date {
            background: white;
            border: 2px solid #28a745;
            border-radius: 6px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .suggested-date:hover {
            background: #28a745;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }

        .suggested-date.selected {
            background: #28a745;
            color: white;
            border-color: #1e7e34;
        }

        .date-info {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .date-slots {
            font-size: 0.7rem;
            opacity: 0.8;
        }

        .no-dates-available {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .card:hover::before {
            left: 100%;
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 8px;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .scheduling-interface {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .time-slot {
            background: #ecf0f1;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }

        .time-slot:hover {
            background: #d5dbdb;
            transform: scale(1.02);
        }

        .time-slot.booked {
            background: #e74c3c;
            color: white;
            cursor: not-allowed;
        }

        .time-slot.available {
            background: #27ae60;
            color: white;
        }

        .time-slot.optimized {
            background: #3498db;
            color: white;
        }

        .time-slot.passed {
            background: #95a5a6;
            color: white;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .time-slot.current {
            background: #f39c12;
            color: white;
            animation: pulse 2s infinite;
            border: 3px solid #e67e22;
        }

        .time-slot.weekend {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
            opacity: 0.7;
            cursor: not-allowed;
        }

        .time-slot.selected {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: 3px solid #2980b9;
            transform: scale(1.05);
        }

        .time-slot.patient-info {
            font-size: 0.7rem;
            margin-top: 5px;
            opacity: 0.9;
            font-weight: bold;
        }

        .time-slot-status {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.6rem;
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 3px;
            background: rgba(0, 0, 0, 0.3);
        }

        .patient-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .patient-item {
            background: #ffffff;
            border-left: 4px solid #3498db;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .patient-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .patient-item.high-priority {
            border-left-color: #e74c3c;
            background: linear-gradient(135deg, #fdf2f2, #ffffff);
        }

        .patient-item.medium-priority {
            border-left-color: #f39c12;
            background: linear-gradient(135deg, #fef9e7, #ffffff);
        }

        .patient-item.urgent-priority {
            border-left-color: #8e44ad;
            background: linear-gradient(135deg, #f4ecf7, #ffffff);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 2px 8px rgba(142, 68, 173, 0.3); }
            50% { box-shadow: 0 4px 20px rgba(142, 68, 173, 0.5); }
            100% { box-shadow: 0 2px 8px rgba(142, 68, 173, 0.3); }
        }

        .patient-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .patient-info {
            flex: 1;
        }

        .patient-name {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .patient-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .patient-status-section {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
        }

        .patient-wait-days {
            background: #e74c3c;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            text-align: center;
            min-width: 60px;
        }

        .patient-wait-days.low {
            background: #27ae60;
        }

        .patient-wait-days.medium {
            background: #f39c12;
        }

        .patient-wait-days.high {
            background: #e74c3c;
        }

        .patient-status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-scheduled {
            background: #3498db;
            color: white;
        }

        .status-waiting {
            background: #e67e22;
            color: white;
        }

        .status-in-progress {
            background: #9b59b6;
            color: white;
        }

        .status-completed {
            background: #27ae60;
            color: white;
        }

        .patient-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .patient-action-btn {
            background: #ecf0f1;
            border: none;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .patient-action-btn:hover {
            background: #3498db;
            color: white;
        }

        .queue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .queue-filters {
            display: flex;
            gap: 10px;
        }

        .filter-btn {
            background: #ecf0f1;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: #3498db;
            color: white;
        }

        .filter-btn:hover {
            background: #3498db;
            color: white;
        }

        .date-status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
            margin-top: 5px;
        }

        .date-status-badge.today {
            background: #e74c3c;
            color: white;
            animation: pulse 2s infinite;
        }

        .date-status-badge.past {
            background: #95a5a6;
            color: white;
        }

        .date-status-badge.future {
            background: #27ae60;
            color: white;
        }

        .patient-item.high-priority {
            border-left-color: #e74c3c;
            background: #fdf2f2;
        }

        .patient-item.medium-priority {
            border-left-color: #f39c12;
            background: #fef9e7;
        }

        .feedback-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .feedback-form {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .feedback-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .optimization-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-available { background: #27ae60; }
        .status-booked { background: #e74c3c; }
        .status-optimized { background: #3498db; }

        .wait-time-display {
            background: linear-gradient(135deg, #ff7675, #fd79a8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(255, 118, 117, 0.3);
        }

        .wait-time-value {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .wait-days-display {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
            border: 3px solid rgba(255, 255, 255, 0.2);
        }

        .wait-days-value {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .wait-days-label {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .wait-days-trend {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .wait-days-improvement {
            color: #2ecc71;
            font-weight: bold;
        }

        .wait-days-warning {
            color: #f39c12;
            font-weight: bold;
        }

        .analytics-chart {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .chart-bar {
            background: #3498db;
            height: 20px;
            margin-bottom: 10px;
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .chart-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .analytics-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #3498db;
        }

        .analytics-card h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 0.9rem;
        }

        .analytics-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .analytics-label {
            font-size: 0.8rem;
            color: #7f8c8d;
        }

        .schedule-insights {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #28a745;
        }

        .schedule-insights h4 {
            margin: 0 0 10px 0;
            color: #28a745;
            font-size: 0.9rem;
        }

        .insight-item {
            background: white;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 6px;
            font-size: 0.85rem;
            border-left: 3px solid #28a745;
        }

        .wait-time-chart {
            background: linear-gradient(135deg, #ff7675, #fd79a8);
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .wait-time-chart h4 {
            margin: 0 0 15px 0;
            font-size: 1rem;
        }

        .wait-time-bar {
            background: rgba(255, 255, 255, 0.3);
            height: 25px;
            border-radius: 12px;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
        }

        .wait-time-fill {
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            transition: width 0.8s ease;
            position: relative;
        }

        .wait-time-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: shimmer 2s infinite;
        }

        .wait-time-label {
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .wait-time-value {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        @media (max-width: 768px) {
            .dashboard,
            .scheduling-interface,
            .feedback-section {
                grid-template-columns: 1fr;
            }
            
            .schedule-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üè• Schedule Management System</h1>
            <p>Professional scheduling ‚Ä¢ Operational efficiency ‚Ä¢ Staff management</p>
        </div>

        <!-- Navigation Menu -->
        <nav class="navigation-menu">
            <div class="nav-container">
                <button class="nav-btn active" onclick="showSection('dashboard')">üè† Dashboard</button>
                <button class="nav-btn" onclick="showSection('scheduling')">üìÖ Scheduling</button>
                <button class="nav-btn" onclick="showSection('patients')">üë• Patients</button>
                <button class="nav-btn" onclick="showSection('feedback')">üí¨ Feedback</button>
                <button class="nav-btn" onclick="showSection('analytics')">üìà Analytics</button>
                <button class="nav-btn" onclick="showSection('performance')">üìä Performance</button>
            </div>
        </nav>

        <!-- Dashboard Section (Default View) -->
        <div id="dashboard-section" class="section active">
            <!-- Professional Clinic Operations Dashboard -->
            <div class="dashboard">
                <div class="card">
                    <h2>üìä Clinic Performance Metrics</h2>
                <div style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 15px; position: relative; overflow: hidden;">
                    <div class="counter" id="avgWaitDays">12.3</div>
                    <div style="font-size: 0.9rem; margin-bottom: 8px;">Average Wait Days</div>
                    <div style="font-size: 0.75rem; opacity: 0.8; margin-bottom: 10px;">Target: ‚â§7 days</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="waitDaysProgress" style="width: 100%; background: linear-gradient(90deg, #e74c3c, #c0392b);"></div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; border-left: 3px solid #e74c3c;">
                        <div style="font-weight: 600; color: #e74c3c; font-size: 0.85rem;">‚ùå Target Missed</div>
                        <div style="font-size: 0.75rem; color: #7f8c8d;">76% over target</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; border-left: 3px solid #e74c3c;">
                        <div style="font-weight: 600; color: #e74c3c; font-size: 0.85rem;">üìâ Declining</div>
                        <div style="font-size: 0.75rem; color: #7f8c8d;">+23% this week</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üë©‚Äç‚öïÔ∏è Dr. Sarah's Professional Status</h2>
                <div style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 15px; position: relative; overflow: hidden;">
                    <div style="font-size: 1.4rem; margin-bottom: 8px;">
                        <span class="status-indicator danger"></span>OVERWHELMED
                    </div>
                    <div style="font-size: 0.9rem; margin-bottom: 8px;">Behind schedule - 3 patients waiting</div>
                    <div style="font-size: 0.75rem; opacity: 0.8;">Updated: <span id="lastUpdated">Just now</span></div>
                    <div class="progress-bar" style="margin-top: 10px;">
                        <div class="progress-fill" id="doctorStatusProgress" style="width: 100%; background: linear-gradient(90deg, #e74c3c, #c0392b);"></div>
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                    <h4 style="margin: 0 0 8px 0; color: #2c3e50; font-size: 0.9rem;">üìã Daily Operations</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.8rem;">
                        <div><strong>Total:</strong> <span id="patientsToday">8</span></div>
                        <div><strong>Completed:</strong> <span id="completedTodayPatient">2</span></div>
                        <div><strong>In Progress:</strong> <span id="inProgressToday">1</span></div>
                        <div><strong>Pending:</strong> <span id="waitingToday">5</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Alert -->
        <div class="card" style="background: linear-gradient(135deg, #fff3cd, #ffeaa7); border-left: 5px solid #f39c12; margin-bottom: 20px;">
            <h2 style="color: #856404; margin-bottom: 15px;">‚ö†Ô∏è Performance Alert</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <h4 style="color: #856404; margin-bottom: 10px;">üö® Critical Issues</h4>
                    <ul style="color: #856404; font-size: 0.9rem; margin: 0; padding-left: 20px;">
                        <li>Wait time 76% over target</li>
                        <li>5 patients waiting today</li>
                        <li>Dr. Sarah overwhelmed</li>
                        <li>Schedule backlog growing</li>
                    </ul>
                </div>
                <div>
                    <h4 style="color: #856404; margin-bottom: 10px;">üìã Immediate Actions</h4>
                    <ul style="color: #856404; font-size: 0.9rem; margin: 0; padding-left: 20px;">
                        <li>Reschedule non-urgent cases</li>
                        <li>Extend working hours</li>
                        <li>Prioritize urgent patients</li>
                        <li>Consider temporary help</li>
                    </ul>
                </div>
            </div>
        </div>

            </div>
        </div>

        <!-- Scheduling Section -->
        <div id="scheduling-section" class="section">
            <div class="scheduling-interface">
                <div class="card">
                    <h2>üìÖ Schedule New Appointment</h2>
                <form id="appointmentForm">
                    <div class="form-group">
                        <label for="patientName">Patient Name</label>
                        <input type="text" id="patientName" required>
                    </div>
                    <div class="form-group">
                        <label for="patientType">Appointment Type</label>
                        <select id="patientType" required>
                            <option value="">Select Type</option>
                            <option value="consultation">Initial Consultation</option>
                            <option value="followup">Follow-up</option>
                            <option value="treatment">Treatment</option>
                            <option value="urgent">Urgent Care</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="priority">Priority Level</label>
                        <select id="priority" required>
                            <option value="low">Low Priority</option>
                            <option value="medium">Medium Priority</option>
                            <option value="high">High Priority</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="preferredDate">Preferred Date</label>
                        <div class="business-day-calendar">
                            <input type="date" id="preferredDate" required>
                            <div class="weekend-warning" id="weekendWarning">
                                Weekends are not available for appointments. The date has been automatically adjusted to the next business day.
                            </div>
                            <div class="date-suggestions" id="dateSuggestions">
                                <h4>üìÖ Limited Available Dates (High Demand):</h4>
                                <div class="suggested-dates" id="suggestedDatesList">
                                    <!-- Available dates will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="notes">Special Notes</label>
                        <textarea id="notes" rows="3" placeholder="Any special requirements or notes..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">Schedule Appointment</button>
                </form>
            </div>

            <div class="card">
                <h2>üîß Optimization Controls</h2>
                <div class="optimization-controls">
                    <button class="btn" onclick="reduceWaitDays()">üìÖ Reduce Wait Days</button>
                    <button class="btn btn-warning" onclick="optimizeSchedule()">üöÄ Optimize Schedule</button>
                    <button class="btn btn-success" onclick="balanceWorkload()">‚öñÔ∏è Balance Workload</button>
                    <button class="btn" onclick="generateReport()">üìà Generate Report</button>
                </div>
                
                <h3>Today's Schedule Overview</h3>
                <div class="schedule-grid" id="scheduleGrid">
                    <!-- Schedule slots will be populated by JavaScript -->
                </div>
            </div>
        </div>

            </div>
        </div>

        <!-- Patients Section -->
        <div id="patients-section" class="section">
            <div class="dashboard">
                <div class="card">
                    <div class="queue-header">
                        <h2>üë• Patient Queue</h2>
                        <div style="background: rgba(52, 152, 219, 0.1); padding: 8px; border-radius: 6px; border-left: 3px solid #3498db;">
                            <div style="font-size: 0.8rem; color: #2c3e50;">
                                <strong>Queue Status:</strong> Monitor scheduled patients and appointment flow
                            </div>
                        </div>
                    </div>
                    
                    <!-- Queue Filters -->
                    <div style="display: flex; gap: 8px; margin: 12px 0; flex-wrap: wrap;">
                        <button class="queue-filter-btn active" onclick="filterQueue('all')">All</button>
                        <button class="queue-filter-btn" onclick="filterQueue('today')">Today</button>
                        <button class="queue-filter-btn" onclick="filterQueue('urgent')">Urgent</button>
                        <button class="queue-filter-btn" onclick="filterQueue('waiting')">Waiting</button>
                        <button class="queue-filter-btn" onclick="filterQueue('scheduled')">Scheduled</button>
                    </div>
                    
                    <!-- Patient Queue List -->
                    <div class="patient-queue" id="patientQueue">
                        <!-- Patient queue items will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Priority Management Card -->
                <div class="card">
                    <h2>üö® Priority Management</h2>
                    
                    <!-- Urgent Cases Section -->
                    <div style="background: linear-gradient(135deg, #fee, #fdd); border-left: 4px solid #e74c3c; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 10px 0; color: #721c24; font-size: 1rem; font-weight: 600;">
                            üö® URGENT CASES
                        </h4>
                        <div style="font-size: 1.3rem; font-weight: bold; color: #e74c3c; margin-bottom: 8px;">
                            <span id="urgentCount">0</span> patients requiring immediate attention
                        </div>
                        <div id="urgentCasesList" style="font-size: 0.85rem; color: #721c24; max-height: 120px; overflow-y: auto;">
                            <!-- Urgent cases will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Non-Urgent Cases Section -->
                    <div style="background: linear-gradient(135deg, #f0f8ff, #e6f3ff); border-left: 4px solid #3498db; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 10px 0; color: #1a5490; font-size: 1rem; font-weight: 600;">
                            üìã NON-URGENT CASES
                        </h4>
                        <div style="font-size: 1.3rem; font-weight: bold; color: #3498db; margin-bottom: 8px;">
                            <span id="nonUrgentCount">0</span> patients with routine appointments
                        </div>
                        <div id="nonUrgentCasesList" style="font-size: 0.85rem; color: #1a5490; max-height: 120px; overflow-y: auto;">
                            <!-- Non-urgent cases will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Patient Selection for Rescheduling -->
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #dee2e6;">
                        <h4 style="margin: 0 0 10px 0; color: #495057; font-size: 0.9rem;">üîÑ Manual Patient Rescheduling</h4>
                        <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: end;">
                            <div>
                                <label style="display: block; font-size: 0.8rem; color: #666; margin-bottom: 5px;">Select Patient to Reschedule:</label>
                                <select id="patientRescheduleSelect" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.85rem;">
                                    <option value="">Choose a patient...</option>
                                </select>
                            </div>
                            <button onclick="rescheduleSelectedPatient()" style="background: #f39c12; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 0.8rem; cursor: pointer; white-space: nowrap;">
                                üîÑ Reschedule Selected
                            </button>
                        </div>
                        <div id="rescheduleInfo" style="margin-top: 10px; font-size: 0.8rem; color: #666; display: none;">
                            <!-- Patient info will be shown here -->
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="scheduleNextUrgent()" style="background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 0.8rem; cursor: pointer;">
                            üìÖ Schedule Next Urgent
                        </button>
                        <button onclick="rescheduleNonUrgent()" style="background: #f39c12; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 0.8rem; cursor: pointer;">
                            üîÑ Auto Reschedule Non-Urgent
                        </button>
                        <button onclick="viewWaitingList()" style="background: #3498db; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 0.8rem; cursor: pointer;">
                            üìã View Waiting List
                        </button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üìà Professional Analytics Dashboard</h2>
                
                <!-- Key Performance Indicators -->
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h4>üìÖ Daily Capacity</h4>
                        <div class="analytics-value" id="todayAppointments">1</div>
                        <div class="analytics-label">Appointments Scheduled</div>
                    </div>
                    <div class="analytics-card">
                        <h4>‚è±Ô∏è Wait Time Performance</h4>
                        <div class="analytics-value" id="avgWaitDaysAnalytics">4.2</div>
                        <div class="analytics-label">Average Wait Days</div>
                    </div>
                    <div class="analytics-card">
                        <h4>üéØ Resource Utilization</h4>
                        <div class="analytics-value" id="utilizationAnalytics">78%</div>
                        <div class="analytics-label">Schedule Efficiency</div>
                    </div>
                    <div class="analytics-card">
                        <h4>‚ö° Capacity Planning</h4>
                        <div class="analytics-value" id="nextAvailable">1</div>
                        <div class="analytics-label">Next Open Slot (Days)</div>
                    </div>
                </div>


                <!-- Wait Days Distribution Chart -->
                <div class="wait-time-chart">
                    <h4>üìÖ Patient Wait Days Distribution</h4>
                    <div class="wait-time-bar">
                        <div class="wait-time-fill" style="width: 15%;"></div>
                        <div class="wait-time-label">‚â§3 Days</div>
                        <div class="wait-time-value">15%</div>
                    </div>
                    <div class="wait-time-bar">
                        <div class="wait-time-fill" style="width: 35%;"></div>
                        <div class="wait-time-label">4-7 Days</div>
                        <div class="wait-time-value">35%</div>
                    </div>
                    <div class="wait-time-bar">
                        <div class="wait-time-fill" style="width: 30%;"></div>
                        <div class="wait-time-label">8-14 Days</div>
                        <div class="wait-time-value">30%</div>
                    </div>
                    <div class="wait-time-bar">
                        <div class="wait-time-fill" style="width: 20%;"></div>
                        <div class="wait-time-label">>14 Days</div>
                        <div class="wait-time-value">20%</div>
                    </div>
                </div>

                <!-- Schedule Insights -->
                <div class="schedule-insights">
                    <h4>üí° Schedule Optimization Insights</h4>
                    <div class="insight-item" id="insight1">‚úÖ Target achieved: 15% of patients seen within 3 days</div>
                    <div class="insight-item" id="insight2">‚ö†Ô∏è 20% of patients wait >14 days - needs attention</div>
                    <div class="insight-item" id="insight3">üìà Peak utilization at 9:00 AM (95%) - consider adding slots</div>
                    <div class="insight-item" id="insight4">üïê Low utilization at 4:00 PM (70%) - opportunity for optimization</div>
                </div>

                <!-- Patient Load Summary -->
                <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #3498db;">
                    <h4 style="margin: 0 0 10px 0; color: #2c3e50;">üìã Patient Load Summary</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem;">
                        <div><strong>Active Patients:</strong> <span id="activePatients">6</span></div>
                        <div><strong>Completed Today:</strong> <span id="completedToday">1</span></div>
                        <div><strong>Scheduled:</strong> <span id="scheduledCount">3</span></div>
                        <div><strong>Waiting:</strong> <span id="waitingCount">2</span></div>
                        <div><strong>Urgent Cases:</strong> <span id="urgentCount">1</span></div>
                        <div><strong>Avg Wait Days:</strong> <span id="avgWaitDaysSummary">4</span> days</div>
                    </div>
                </div>
            </div>
        </div>

            </div>
        </div>

        <!-- Analytics Section -->
        <div id="analytics-section" class="section">
            <div class="dashboard">
                <div class="card">
                    <h2>üìà Professional Analytics Dashboard</h2>
                    
                    <!-- Key Performance Indicators -->
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <h4>üìÖ Daily Capacity</h4>
                            <div class="analytics-value" id="todayAppointments">1</div>
                            <div class="analytics-label">Appointments Scheduled</div>
                        </div>
                        <div class="analytics-card">
                            <h4>‚è±Ô∏è Wait Time Performance</h4>
                            <div class="analytics-value" id="avgWaitDaysAnalytics">4.2</div>
                            <div class="analytics-label">Average Wait Days</div>
                        </div>
                        <div class="analytics-card">
                            <h4>üéØ Resource Utilization</h4>
                            <div class="analytics-value" id="utilizationAnalytics">78%</div>
                            <div class="analytics-label">Schedule Efficiency</div>
                        </div>
                        <div class="analytics-card">
                            <h4>‚ö° Capacity Planning</h4>
                            <div class="analytics-value" id="nextAvailable">1</div>
                            <div class="analytics-label">Next Open Slot (Days)</div>
                        </div>
                    </div>

                    <!-- Wait Days Distribution Chart -->
                    <div class="wait-time-chart">
                        <h4>üìÖ Patient Wait Days Distribution</h4>
                        <div class="wait-time-bar">
                            <div class="wait-time-fill" style="width: 15%;"></div>
                            <div class="wait-time-label">‚â§3 Days</div>
                            <div class="wait-time-value">15%</div>
                        </div>
                        <div class="wait-time-bar">
                            <div class="wait-time-fill" style="width: 35%;"></div>
                            <div class="wait-time-label">4-7 Days</div>
                            <div class="wait-time-value">35%</div>
                        </div>
                        <div class="wait-time-bar">
                            <div class="wait-time-fill" style="width: 30%;"></div>
                            <div class="wait-time-label">8-14 Days</div>
                            <div class="wait-time-value">30%</div>
                        </div>
                        <div class="wait-time-bar">
                            <div class="wait-time-fill" style="width: 20%;"></div>
                            <div class="wait-time-label">>14 Days</div>
                            <div class="wait-time-value">20%</div>
                        </div>
                    </div>

                    <!-- Schedule Insights -->
                    <div class="schedule-insights">
                        <h4>üí° Schedule Optimization Insights</h4>
                        <div class="insight-item" id="insight1">‚úÖ Target achieved: 15% of patients seen within 3 days</div>
                        <div class="insight-item" id="insight2">‚ö†Ô∏è 20% of patients wait >14 days - needs attention</div>
                        <div class="insight-item" id="insight3">üìà Peak utilization at 9:00 AM (95%) - consider adding slots</div>
                        <div class="insight-item" id="insight4">üïê Low utilization at 4:00 PM (70%) - opportunity for optimization</div>
                    </div>

                    <!-- Patient Load Summary -->
                    <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #3498db;">
                        <h4 style="margin: 0 0 10px 0; color: #2c3e50;">üìã Patient Load Summary</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem;">
                            <div><strong>Active Patients:</strong> <span id="activePatients">6</span></div>
                            <div><strong>Completed Today:</strong> <span id="completedToday">1</span></div>
                            <div><strong>Scheduled:</strong> <span id="scheduledCount">3</span></div>
                            <div><strong>Waiting:</strong> <span id="waitingCount">2</span></div>
                            <div><strong>Urgent Cases:</strong> <span id="urgentCount">1</span></div>
                            <div><strong>Avg Wait Days:</strong> <span id="avgWaitDaysSummary">4</span> days</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Section -->
        <div id="performance-section" class="section">
            <div class="dashboard">
                <div class="card">
                    <h2>üìà Operational Excellence Metrics</h2>
                <div id="operationalPerformanceAchievement" style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <h3 style="margin: 0 0 10px 0; font-size: 1.5rem;">‚ö†Ô∏è Operational Performance Issues</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; text-align: center;">
                        <div>
                            <div id="waitTimeReduction" style="font-size: 2.5rem; font-weight: bold;">+147%</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Wait Time Increase</div>
                        </div>
                        <div>
                            <div id="currentAvgWaitDays" style="font-size: 2.5rem; font-weight: bold;">12.3</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Current Avg (Days)</div>
                        </div>
                        <div>
                            <div id="targetWaitDays" style="font-size: 2.5rem; font-weight: bold;">5.0</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Target Avg (Days)</div>
                        </div>
                    </div>
                </div>

                <!-- Progress Timeline -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; color: #2c3e50;">üìÖ Performance Timeline</h4>
                    <div style="position: relative;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                            <div style="text-align: center; flex: 1;">
                                <div style="width: 60px; height: 60px; background: #e74c3c; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">12.8</div>
                                <div style="font-size: 0.8rem; color: #7f8c8d;">Month 1<br>Before Optimization</div>
                            </div>
                            <div style="text-align: center; flex: 1;">
                                <div style="width: 60px; height: 60px; background: #f39c12; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">8.5</div>
                                <div style="font-size: 0.8rem; color: #7f8c8d;">Month 2<br>Initial Improvements</div>
                            </div>
                            <div style="text-align: center; flex: 1;">
                                <div style="width: 60px; height: 60px; background: #3498db; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">6.2</div>
                                <div style="font-size: 0.8rem; color: #7f8c8d;">Month 3<br>System Implementation</div>
                            </div>
                            <div style="text-align: center; flex: 1;">
                                <div style="width: 60px; height: 60px; background: #e74c3c; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">12.3</div>
                                <div style="font-size: 0.8rem; color: #7f8c8d;">Current<br>Target Missed!</div>
                            </div>
                        </div>
                        <div style="position: absolute; top: 30px; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #e74c3c, #f39c12, #3498db, #e74c3c); border-radius: 2px;"></div>
                    </div>
                </div>

                <!-- Professional Achievements -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="background: #ffeaea; padding: 15px; border-radius: 10px; border-left: 4px solid #e74c3c;">
                        <h4 style="margin: 0 0 10px 0; color: #e74c3c;">‚ùå Performance Issues</h4>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9rem; color: #2c3e50;">
                            <li>147% increase in average wait time</li>
                            <li>Only 15% of appointments scheduled within 7 days</li>
                            <li>25% urgent case coverage within 24 hours</li>
                            <li>2.1/5 patient satisfaction rating</li>
                        </ul>
                    </div>
                    <div style="background: #fff3cd; padding: 15px; border-radius: 10px; border-left: 4px solid #ffc107;">
                        <h4 style="margin: 0 0 10px 0; color: #856404;">üéØ Recovery Objectives</h4>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9rem; color: #2c3e50;">
                            <li>Target: Reduce to 7-day average wait time</li>
                            <li>Implement emergency appointment slots</li>
                            <li>Increase clinic capacity utilization</li>
                            <li>Achieve 3.5/5 patient satisfaction rating</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üìä Professional Performance Analytics</h2>
                
                <!-- Weekly Progress Chart -->
                <div id="weeklyTrendsChart" style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <h4 style="margin: 0 0 15px 0; color: #2c3e50;">üìà Weekly Wait Time Trends</h4>
                    <div id="weeklyChartContainer" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; height: 120px; align-items: end;">
                        <!-- Chart will be dynamically generated -->
                    </div>
                </div>

                <!-- Professional Implementation Actions -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; color: #2c3e50;">üîß Professional Implementation Actions</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <h5 style="color: #27ae60; margin: 0 0 10px 0;">‚úÖ Completed Implementations</h5>
                            <ul style="margin: 0; padding-left: 20px; font-size: 0.9rem; color: #2c3e50;">
                                <li>Priority-based scheduling system</li>
                                <li>Real-time wait time monitoring</li>
                                <li>Appointment slot optimization</li>
                                <li>Professional management dashboard</li>
                                <li>Automated schedule optimization</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: #3498db; margin: 0 0 10px 0;">üîÑ Active Operations</h5>
                            <ul style="margin: 0; padding-left: 20px; font-size: 0.9rem; color: #2c3e50;">
                                <li>Continuous schedule monitoring</li>
                                <li>Real-time patient status tracking</li>
                                <li>Dynamic appointment management</li>
                                <li>Performance analytics integration</li>
                                <li>Operational efficiency tracking</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Professional Impact Summary -->
                <div id="professionalImpactSummary" style="background: linear-gradient(135deg, #2c3e50, #34495e); color: white; padding: 20px; border-radius: 15px;">
                    <h4 style="margin: 0 0 15px 0;">üìä Professional Performance Impact</h4>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; text-align: center;">
                        <div>
                            <div id="waitTimeImpact" style="font-size: 1.8rem; font-weight: bold;">67%</div>
                            <div style="font-size: 0.8rem; opacity: 0.9;">Wait Time Reduction</div>
                        </div>
                        <div>
                            <div id="targetAchievementImpact" style="font-size: 1.8rem; font-weight: bold;">95%</div>
                            <div style="font-size: 0.8rem; opacity: 0.9;">Target Achievement</div>
                        </div>
                        <div>
                            <div id="patientSatisfactionImpact" style="font-size: 1.8rem; font-weight: bold;">4.8/5</div>
                            <div style="font-size: 0.8rem; opacity: 0.9;">Patient Satisfaction</div>
                        </div>
                        <div>
                            <div id="urgentCareCoverageImpact" style="font-size: 1.8rem; font-weight: bold;">100%</div>
                            <div style="font-size: 0.8rem; opacity: 0.9;">Urgent Care Coverage</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

            </div>
        </div>

        <!-- Feedback Section -->
        <div id="feedback-section" class="section">
            <div class="feedback-section">
                <div class="feedback-form">
                    <h2>üí¨ Professional Feedback & Quality Assurance</h2>
                <form id="feedbackForm">
                    <div class="form-group">
                        <label for="feedbackType">Feedback Type</label>
                        <select id="feedbackType" required>
                            <option value="">Select Type</option>
                            <option value="wait-time">Wait Time</option>
                            <option value="staff">Staff Experience</option>
                            <option value="scheduling">Scheduling Process</option>
                            <option value="facility">Facility</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="feedbackRating">Rating (1-5)</label>
                        <select id="feedbackRating" required>
                            <option value="">Select Rating</option>
                            <option value="1">1 - Poor</option>
                            <option value="2">2 - Fair</option>
                            <option value="3">3 - Good</option>
                            <option value="4">4 - Very Good</option>
                            <option value="5">5 - Excellent</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="feedbackComment">Comments</label>
                        <textarea id="feedbackComment" rows="4" placeholder="Please share your experience..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">Submit Feedback</button>
                </form>
            </div>

            <div class="feedback-form">
                <h2>üìã Recent Feedback</h2>
                <div id="recentFeedback">
                    <!-- Feedback items will be populated by JavaScript -->
                </div>
            </div>
        </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" onclick="showUrgentAlert()" title="Urgent Cases Alert">
        üö®
    </button>

    <script>
        // Navigation function with smooth transitions
        function showSection(sectionId) {
            // Hide all sections with fade out
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.style.opacity = '0';
                section.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    section.classList.remove('active');
                }, 200);
            });
            
            // Show selected section with fade in
            setTimeout(() => {
                const targetSection = document.getElementById(sectionId + '-section');
                if (targetSection) {
                    targetSection.classList.add('active');
                    targetSection.style.opacity = '1';
                    targetSection.style.transform = 'translateY(0)';
                }
            }, 200);
            
            // Update navigation buttons
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Activate clicked button
            event.target.classList.add('active');
        }

        // Show urgent cases alert (Underperformance Scenario)
        function showUrgentAlert() {
            // Simulate high urgent cases due to underperformance
            const urgentCases = 8; // Simulated high number
            showToast(`üö® ${urgentCases} urgent patients waiting! Critical backlog!`, 'error');
            showSection('patients');
            
            // Show additional warning toast
            setTimeout(() => {
                showToast('‚ö†Ô∏è Dr. Sarah is overwhelmed - immediate action needed!', 'warning');
            }, 1000);
        }

        // Toast notification system
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div style="font-weight: 600; margin-bottom: 5px;">${message}</div>
                <div style="font-size: 0.8rem; opacity: 0.8;">${new Date().toLocaleTimeString()}</div>
            `;
            
            document.body.appendChild(toast);
            
            // Show toast
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Hide toast after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // Animate counter values
        function animateCounter(elementId, targetValue, duration = 1000) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const startValue = parseFloat(element.textContent) || 0;
            const increment = (targetValue - startValue) / (duration / 16);
            let currentValue = startValue;
            
            const timer = setInterval(() => {
                currentValue += increment;
                if ((increment > 0 && currentValue >= targetValue) || 
                    (increment < 0 && currentValue <= targetValue)) {
                    currentValue = targetValue;
                    clearInterval(timer);
                }
                element.textContent = currentValue.toFixed(1);
            }, 16);
        }

        // Animate progress bars
        function animateProgress(elementId, targetWidth, duration = 1000) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            element.style.transition = `width ${duration}ms ease-in-out`;
            element.style.width = targetWidth + '%';
        }

        // Prevent Firebase initialization
        window.firebase = undefined;
        console.log('Firebase blocked from initialization');
        
        // Global state management
        let appointments = [];
        let feedback = [];
        let schedule = {};
        let doctor = 'Dr. Sarah Johnson'; // Single doctor
        let currentQueueFilter = 'all';
        
        // Global update system - tracks all components that need updating
        const updateComponents = {
            dashboard: true,
            calendar: true,
            patientQueue: true,
            analytics: true,
            priorityManagement: true,
            dateSuggestions: true
        };
        
        // Global update function - refreshes ALL interconnected components simultaneously
        function updateAllComponents() {
            console.log('üîÑ Updating ALL components simultaneously...');
            
            // Calculate all metrics once for efficiency
            const avgWaitDays = calculateAverageWaitDays();
            const totalAppointments = appointments.length;
            const urgentAppointments = appointments.filter(apt => apt.priority === 'urgent').length;
            const waitingAppointments = appointments.filter(apt => apt.status === 'waiting').length;
            const scheduledAppointments = appointments.filter(apt => apt.status === 'scheduled').length;
            
            // Update ALL dashboard metrics simultaneously
            if (updateComponents.dashboard) {
                updatePatientCentricDashboard();
                updateClinicProgress();
                updateOperationalPerformanceAchievement();
                updateProfessionalImpactSummary();
            }
            
            // Update ALL calendar and scheduling components simultaneously
            if (updateComponents.calendar) {
                updateScheduleGrid();
                updateCalendarAvailability();
                generateAvailableDateSuggestions();
            }
            
            // Update ALL patient management components simultaneously (no duplicates)
            if (updateComponents.patientQueue) {
                updatePatientQueue();
                updateUrgentCases();
                populateRescheduleDropdown();
            }
            
            // Update ALL analytics components simultaneously
            if (updateComponents.analytics) {
                updateAnalyticsDashboard();
                updateWeeklyChart(generateWeeklyTrends(avgWaitDays));
                updateScheduleInsights();
            }
            
            // Update ALL priority management components simultaneously (no duplicates)
            if (updateComponents.priorityManagement) {
                updatePriorityCases(); // This calls updateUrgentCases() and updateNonUrgentCases()
                populateRescheduleDropdown();
            }
            
            // Update ALL performance tracking simultaneously
            updatePerformanceMetrics();
            updateAchievementStatus();
            
            console.log('‚úÖ ALL components updated simultaneously');
        }
        
        // Trigger update when appointments change
        function triggerGlobalUpdate() {
            updateAllComponents();
        }
        
        // Verify all update functions exist and work
        function verifyUpdateFunctions() {
            const requiredFunctions = [
                'updatePatientCentricDashboard',
                'updateClinicProgress', 
                'updateOperationalPerformanceAchievement',
                'updateProfessionalImpactSummary',
                'updateScheduleGrid',
                'updateCalendarAvailability',
                'generateAvailableDateSuggestions',
                'updatePatientQueue',
                'updateUrgentCases',
                'populateRescheduleDropdown',
                'updateAnalyticsDashboard',
                'updateWeeklyChart',
                'updateScheduleInsights',
                'updatePriorityCases',
                'updatePerformanceMetrics',
                'updateAchievementStatus'
            ];
            
            const missingFunctions = [];
            requiredFunctions.forEach(funcName => {
                if (typeof window[funcName] !== 'function') {
                    missingFunctions.push(funcName);
                }
            });
            
            if (missingFunctions.length > 0) {
                console.error('‚ùå Missing update functions:', missingFunctions);
                return false;
            } else {
                console.log('‚úÖ All update functions verified');
                return true;
            }
        }
        
        // Enhanced data change listener - ensures ALL content updates simultaneously
        function onDataChange(changeType, details) {
            console.log(`üìä Data change detected: ${changeType}`, details);
            
            // Immediately update ALL components simultaneously
            triggerGlobalUpdate();
            
            // Show visual feedback for the change
            showDataChangeNotification(changeType, details);
        }
        
        // Show notification when data changes
        function showDataChangeNotification(changeType, details) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #3498db, #2980b9);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                font-size: 0.9rem;
                font-weight: 500;
                animation: slideInRight 0.3s ease-out;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span>üîÑ</span>
                    <span>${changeType} - All content updated simultaneously</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // Add CSS animations for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // Update performance metrics across all sections
        function updatePerformanceMetrics() {
            const avgWaitDays = calculateAverageWaitDays();
            const totalAppointments = appointments.length;
            const urgentAppointments = appointments.filter(apt => apt.priority === 'urgent').length;
            const waitingAppointments = appointments.filter(apt => apt.status === 'waiting').length;
            const scheduledAppointments = appointments.filter(apt => apt.status === 'scheduled').length;
            
            // Update all metric displays across the system
            updateMetricDisplays({
                avgWaitDays: avgWaitDays,
                totalAppointments: totalAppointments,
                urgentAppointments: urgentAppointments,
                waitingAppointments: waitingAppointments,
                scheduledAppointments: scheduledAppointments
            });
        }
        
        // Update metric displays across all sections
        function updateMetricDisplays(metrics) {
            // Update dashboard metrics
            const avgWaitDaysElement = document.getElementById('avgWaitDays');
            if (avgWaitDaysElement) {
                avgWaitDaysElement.textContent = metrics.avgWaitDays.toFixed(1);
            }
            
            // Update current average wait days in performance section
            const currentAvgWaitDaysElement = document.getElementById('currentAvgWaitDays');
            if (currentAvgWaitDaysElement) {
                currentAvgWaitDaysElement.textContent = metrics.avgWaitDays.toFixed(1);
            }
            
            // Update urgent count in priority management
            const urgentCountElement = document.getElementById('urgentCount');
            if (urgentCountElement) {
                urgentCountElement.textContent = metrics.urgentAppointments;
            }
            
            // Update non-urgent count in priority management
            const nonUrgentCountElement = document.getElementById('nonUrgentCount');
            if (nonUrgentCountElement) {
                nonUrgentCountElement.textContent = metrics.totalAppointments - metrics.urgentAppointments;
            }
            
            // Update patient count displays
            const patientsTodayElement = document.getElementById('patientsToday');
            if (patientsTodayElement) {
                patientsTodayElement.textContent = metrics.scheduledAppointments;
            }
            
            const waitingTodayElement = document.getElementById('waitingToday');
            if (waitingTodayElement) {
                waitingTodayElement.textContent = metrics.waitingAppointments;
            }
        }
        
        // Update priority cases (both urgent and non-urgent)
        function updatePriorityCases() {
            updateUrgentCases();
            updateNonUrgentCases();
        }
        
        // Update non-urgent cases display
        function updateNonUrgentCases() {
            const nonUrgentCountElement = document.getElementById('nonUrgentCount');
            const nonUrgentListElement = document.getElementById('nonUrgentCasesList');
            
            if (!nonUrgentCountElement || !nonUrgentListElement) return;
            
            const nonUrgentCases = appointments.filter(apt => apt.priority !== 'urgent');
            
            nonUrgentCountElement.textContent = nonUrgentCases.length;
            
            // Show first 10 non-urgent cases
            const displayCases = nonUrgentCases.slice(0, 10);
            nonUrgentListElement.innerHTML = '';
            
            displayCases.forEach(apt => {
                const waitDays = calculateWaitDays(apt);
                const statusText = apt.status === 'waiting' ? 'WAITING' : 'SCHEDULED';
                const statusIcon = apt.status === 'waiting' ? '‚è≥' : 'üìÖ';
                
                const listItem = document.createElement('div');
                listItem.style.cssText = `
                    padding: 8px 12px;
                    margin: 5px 0;
                    background: #e3f2fd;
                    border-radius: 6px;
                    border-left: 3px solid #2196f3;
                    font-size: 0.85rem;
                `;
                
                listItem.innerHTML = `
                    <div style="font-weight: 600; color: #1976d2;">${apt.patientName}</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 0.75rem; color: #666;">
                        <div><strong>Status:</strong> ${statusIcon} ${statusText}</div>
                        <div><strong>Wait:</strong> ${waitDays} days</div>
                        <div><strong>Priority:</strong> ${apt.priority.toUpperCase()}</div>
                        <div><strong>Type:</strong> ${apt.type || 'General'}</div>
                    </div>
                `;
                
                nonUrgentListElement.appendChild(listItem);
            });
            
            if (nonUrgentCases.length > 10) {
                const moreItem = document.createElement('div');
                moreItem.style.cssText = `
                    padding: 8px 12px;
                    margin: 5px 0;
                    background: #f5f5f5;
                    border-radius: 6px;
                    font-size: 0.8rem;
                    color: #666;
                    text-align: center;
                `;
                moreItem.textContent = `+ ${nonUrgentCases.length - 10} more routine appointments`;
                nonUrgentListElement.appendChild(moreItem);
            }
        }
        
        // Update calendar availability when appointments change
        function updateCalendarAvailability() {
            const preferredDateInput = document.getElementById('preferredDate');
            const weekendWarning = document.getElementById('weekendWarning');
            
            if (!preferredDateInput) return;
            
            // Add event listener for date changes
            preferredDateInput.addEventListener('input', function() {
                const selectedDate = new Date(this.value);
                const dayOfWeek = selectedDate.getDay();
                const isHolidayDate = isHoliday(selectedDate);
                
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    // Weekend - adjust to next business day
                    const nextBusinessDay = new Date(selectedDate);
                    while (nextBusinessDay.getDay() === 0 || nextBusinessDay.getDay() === 6 || isHoliday(nextBusinessDay)) {
                        nextBusinessDay.setDate(nextBusinessDay.getDate() + 1);
                    }
                    this.value = nextBusinessDay.toISOString().split('T')[0];
                    
                    if (weekendWarning) {
                        weekendWarning.innerHTML = '‚ö†Ô∏è Weekend selected - automatically adjusted to next business day';
                        weekendWarning.style.display = 'block';
                        setTimeout(() => weekendWarning.style.display = 'none', 3000);
                    }
                } else if (isHolidayDate) {
                    // Holiday - adjust to next business day
                    const nextBusinessDay = new Date(selectedDate);
                    while (isHoliday(nextBusinessDay)) {
                        nextBusinessDay.setDate(nextBusinessDay.getDate() + 1);
                    }
                    this.value = nextBusinessDay.toISOString().split('T')[0];
                    
                    if (weekendWarning) {
                        weekendWarning.innerHTML = 'üéÑ Holiday selected - automatically adjusted to next business day';
                        weekendWarning.style.display = 'block';
                        setTimeout(() => weekendWarning.style.display = 'none', 3000);
                    }
                }
                
                // Check availability and update suggestions
                checkDateAvailability(selectedDate);
                generateAvailableDateSuggestions();
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeSchedule();
            loadSampleData();
            
            // Verify all functions exist before updating
            if (verifyUpdateFunctions()) {
                updateAllComponents(); // Use global update system
                startRealTimeUpdates();
                console.log('üöÄ System initialized with simultaneous updates');
            } else {
                console.error('‚ùå System initialization failed - missing functions');
            }
        });

        // Filter patient queue
        function filterQueue(filter) {
            currentQueueFilter = filter;
            
            // Update filter buttons
            document.querySelectorAll('.queue-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Only update patient queue for filtering (not all components)
            updatePatientQueue();
        }

        // Update patient queue display
        function updatePatientQueue() {
            const queueContainer = document.getElementById('patientQueue');
            if (!queueContainer) return;
            
            let filteredAppointments = appointments;
            
            // Apply filter
            switch(currentQueueFilter) {
                case 'today':
                    const today = new Date();
                    filteredAppointments = appointments.filter(apt => {
                        const aptDate = new Date(apt.scheduledDate);
                        return aptDate.toDateString() === today.toDateString();
                    });
                    break;
                case 'urgent':
                    filteredAppointments = appointments.filter(apt => apt.priority === 'urgent');
                    break;
                case 'waiting':
                    filteredAppointments = appointments.filter(apt => apt.status === 'waiting');
                    break;
                case 'scheduled':
                    filteredAppointments = appointments.filter(apt => apt.status === 'scheduled');
                    break;
            }
            
            // Sort by scheduled date
            filteredAppointments.sort((a, b) => new Date(a.scheduledDate) - new Date(b.scheduledDate));
            
            // Generate queue HTML
            if (filteredAppointments.length === 0) {
                queueContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: #666; font-size: 0.8rem;">No patients found for this filter</div>';
                return;
            }
            
            queueContainer.innerHTML = filteredAppointments.map(apt => {
                const waitDays = calculateWaitDays(apt);
                const scheduledDate = new Date(apt.scheduledDate);
                const today = new Date();
                const isToday = scheduledDate.toDateString() === today.toDateString();
                const isPast = scheduledDate < today && !isToday;
                
                let dateStatus = '';
                if (isToday) dateStatus = 'TODAY';
                else if (isPast) dateStatus = 'PAST';
                else dateStatus = 'FUTURE';
                
                return `
                    <div class="queue-item">
                        <div class="patient-info">
                            <div class="patient-name">${apt.patientName}</div>
                            <div class="patient-details">
                                <span>üìÖ ${scheduledDate.toLocaleDateString()} ${scheduledDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                                <span>‚è±Ô∏è ${Math.max(0, waitDays)} days wait</span>
                                <span class="wait-time">${dateStatus}</span>
                            </div>
                        </div>
                        <div class="patient-status">
                            <span class="status-badge status-${apt.status}">${apt.status.toUpperCase()}</span>
                            ${apt.priority === 'urgent' ? '<span class="status-badge status-urgent">URGENT</span>' : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Populate patient reschedule dropdown
        function populateRescheduleDropdown() {
            const select = document.getElementById('patientRescheduleSelect');
            if (!select) return;
            
            // Clear existing options
            select.innerHTML = '<option value="">Choose a patient...</option>';
            
            // Add ALL patients that can be rescheduled (scheduled and waiting)
            const reschedulablePatients = appointments.filter(apt => apt.status === 'scheduled' || apt.status === 'waiting');
            
            // Sort by priority (urgent first) then by scheduled date
            reschedulablePatients.sort((a, b) => {
                const priorityOrder = { urgent: 1, high: 2, medium: 3, low: 4 };
                if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
                    return priorityOrder[a.priority] - priorityOrder[b.priority];
                }
                return new Date(a.scheduledDate) - new Date(b.scheduledDate);
            });
            
            reschedulablePatients.forEach(apt => {
                const scheduledDate = new Date(apt.scheduledDate);
                const waitDays = calculateWaitDays(apt);
                const option = document.createElement('option');
                option.value = apt.id;
                
                // Add priority indicator
                const priorityIcon = apt.priority === 'urgent' ? 'üö®' : 
                                   apt.priority === 'high' ? '‚ö†Ô∏è' : 
                                   apt.priority === 'medium' ? 'üìã' : 'üìÑ';
                
                const statusText = apt.status === 'waiting' ? 'WAITING' : 'SCHEDULED';
                const statusIcon = apt.status === 'waiting' ? '‚è≥' : 'üìÖ';
                
                option.textContent = `${priorityIcon} ${apt.patientName} - ${statusIcon} ${statusText} (${waitDays} days wait) - ${apt.priority.toUpperCase()}`;
                select.appendChild(option);
            });
            
            // Add event listener for selection change
            select.addEventListener('change', function() {
                showPatientRescheduleInfo(this.value);
            });
        }

        // Show patient info when selected for rescheduling
        function showPatientRescheduleInfo(patientId) {
            const infoDiv = document.getElementById('rescheduleInfo');
            if (!infoDiv) return;
            
            if (!patientId) {
                infoDiv.style.display = 'none';
                return;
            }
            
            const patient = appointments.find(apt => apt.id == patientId);
            if (!patient) return;
            
            const scheduledDate = new Date(patient.scheduledDate);
            const requestDate = new Date(patient.requestDate);
            const waitDays = calculateWaitDays(patient);
            
            // Get priority styling
            const priorityIcon = patient.priority === 'urgent' ? 'üö®' : 
                               patient.priority === 'high' ? '‚ö†Ô∏è' : 
                               patient.priority === 'medium' ? 'üìã' : 'üìÑ';
            
            const priorityColor = patient.priority === 'urgent' ? '#e74c3c' : 
                                patient.priority === 'high' ? '#f39c12' : 
                                patient.priority === 'medium' ? '#3498db' : '#27ae60';
            
            const statusText = patient.status === 'waiting' ? 'WAITING' : 'SCHEDULED';
            const statusIcon = patient.status === 'waiting' ? '‚è≥' : 'üìÖ';
            const statusColor = patient.status === 'waiting' ? '#f39c12' : '#27ae60';
            
            infoDiv.innerHTML = `
                <div style="background: white; padding: 10px; border-radius: 6px; border: 1px solid #ddd;">
                    <div style="font-weight: 600; margin-bottom: 5px;">${priorityIcon} ${patient.patientName}</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 0.75rem;">
                        <div><strong>Status:</strong> <span style="color: ${statusColor}; font-weight: bold;">${statusIcon} ${statusText}</span></div>
                        <div><strong>Wait Days:</strong> ${waitDays} days</div>
                        <div><strong>Priority:</strong> <span style="color: ${priorityColor}; font-weight: bold;">${patient.priority.toUpperCase()}</span></div>
                        <div><strong>Type:</strong> ${patient.type}</div>
                        ${patient.status === 'scheduled' ? `<div><strong>Current Date:</strong> ${scheduledDate.toLocaleDateString()}</div>` : ''}
                    </div>
                </div>
            `;
            infoDiv.style.display = 'block';
        }

        // Reschedule selected patient
        function rescheduleSelectedPatient() {
            const select = document.getElementById('patientRescheduleSelect');
            if (!select || !select.value) {
                alert('Please select a patient to reschedule.');
                return;
            }
            
            const patientId = parseInt(select.value);
            const patient = appointments.find(apt => apt.id === patientId);
            
            if (!patient) {
                alert('Patient not found.');
                return;
            }
            
            // Find next available slot
            const nextAvailableSlot = findNextAvailableSlot();
            if (!nextAvailableSlot) {
                alert('üö® No available slots found in the next 90 days - Clinic is severely overbooked due to underperformance!');
                return;
            }
            
            // Confirm rescheduling
            const currentDate = patient.status === 'scheduled' ? new Date(patient.scheduledDate).toLocaleDateString() : 'WAITING';
            const newDate = nextAvailableSlot.toLocaleDateString();
            const priorityIcon = patient.priority === 'urgent' ? 'üö®' : 
                               patient.priority === 'high' ? '‚ö†Ô∏è' : 
                               patient.priority === 'medium' ? 'üìã' : 'üìÑ';
            
            const actionText = patient.status === 'waiting' ? 'Schedule' : 'Reschedule';
            
            if (confirm(`${priorityIcon} ${actionText} ${patient.patientName} (${patient.priority.toUpperCase()}) from ${currentDate} to ${newDate}?`)) {
                // Update appointment
                patient.scheduledDate = nextAvailableSlot.toISOString();
                
                // Trigger data change notification and global update
                onDataChange('Patient Rescheduled', {
                    patient: patient.patientName,
                    oldDate: currentDate,
                    newDate: newDate,
                    priority: patient.priority
                });
                
                // Clear selection
                select.value = '';
                document.getElementById('rescheduleInfo').style.display = 'none';
                
                const successAction = patient.status === 'waiting' ? 'scheduled' : 'rescheduled';
                alert(`‚úÖ ${patient.patientName} has been ${successAction} to ${newDate}`);
            }
        }

        // Update urgent cases display
        function updateUrgentCases() {
            const urgentCases = appointments.filter(apt => apt.priority === 'urgent');
            const nonUrgentCases = appointments.filter(apt => apt.priority !== 'urgent');
            
            const urgentCountElement = document.getElementById('urgentCount');
            const urgentListElement = document.getElementById('urgentCasesList');
            const nonUrgentCountElement = document.getElementById('nonUrgentCount');
            const nonUrgentListElement = document.getElementById('nonUrgentCasesList');
            
            // Update urgent cases
            if (urgentCountElement) {
                urgentCountElement.textContent = urgentCases.length;
            }
            
            if (urgentListElement) {
                if (urgentCases.length === 0) {
                    urgentListElement.innerHTML = '<div style="text-align: center; color: #721c24; padding: 20px; font-style: italic;">‚úÖ No urgent cases pending</div>';
                } else {
                    urgentListElement.innerHTML = urgentCases.map(apt => {
                        const waitDays = calculateWaitDays(apt);
                        const status = apt.status === 'waiting' ? 'WAITING' : 'SCHEDULED';
                        return `<div style="padding: 8px; border-bottom: 1px solid #f5c6cb; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600;">${apt.patientName}</div>
                                <div style="font-size: 0.75rem; opacity: 0.8;">${status}</div>
                            </div>
                            <span style="color: #e74c3c; font-weight: bold; background: rgba(231, 76, 60, 0.1); padding: 2px 6px; border-radius: 4px;">${waitDays} days</span>
                        </div>`;
                    }).join('');
                }
            }
            
            // Update non-urgent cases
            if (nonUrgentCountElement) {
                nonUrgentCountElement.textContent = nonUrgentCases.length;
            }
            
            if (nonUrgentListElement) {
                if (nonUrgentCases.length === 0) {
                    nonUrgentListElement.innerHTML = '<div style="text-align: center; color: #1a5490; padding: 20px; font-style: italic;">üìã No routine appointments</div>';
                } else {
                    nonUrgentListElement.innerHTML = nonUrgentCases.slice(0, 10).map(apt => { // Show first 10
                        const waitDays = calculateWaitDays(apt);
                        const status = apt.status === 'waiting' ? 'WAITING' : 'SCHEDULED';
                        const priorityColor = apt.priority === 'high' ? '#f39c12' : '#27ae60';
                        return `<div style="padding: 8px; border-bottom: 1px solid #b3d9ff; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600;">${apt.patientName}</div>
                                <div style="font-size: 0.75rem; opacity: 0.8;">${status} ‚Ä¢ ${apt.priority.toUpperCase()}</div>
                            </div>
                            <span style="color: ${priorityColor}; font-weight: bold; background: rgba(52, 152, 219, 0.1); padding: 2px 6px; border-radius: 4px;">${waitDays} days</span>
                        </div>`;
                    }).join('');
                    
                    if (nonUrgentCases.length > 10) {
                        nonUrgentListElement.innerHTML += `<div style="text-align: center; padding: 8px; color: #1a5490; font-style: italic; border-top: 1px solid #b3d9ff;">
                            ... and ${nonUrgentCases.length - 10} more routine appointments
                        </div>`;
                    }
                }
            }
            
            // Update reschedule dropdown
            populateRescheduleDropdown();
        }

        // Schedule next urgent patient
        function scheduleNextUrgent() {
            const urgentWaiting = appointments.filter(apt => apt.priority === 'urgent' && apt.status === 'waiting');
            if (urgentWaiting.length === 0) {
                alert('No urgent patients on waiting list');
                return;
            }
            
            const nextUrgent = urgentWaiting[0];
            const nextAvailableSlot = findNextAvailableSlot();
            
            if (nextAvailableSlot) {
                nextUrgent.scheduledDate = nextAvailableSlot.toISOString();
                nextUrgent.status = 'scheduled';
                
                // Trigger data change notification and global update
                onDataChange('Urgent Patient Scheduled', {
                    patient: nextUrgent.patientName,
                    date: nextAvailableSlot.toLocaleDateString(),
                    priority: 'urgent'
                });
                
                alert(`Scheduled ${nextUrgent.patientName} for ${nextAvailableSlot.toLocaleDateString()}`);
            } else {
                alert('No available slots found. Consider rescheduling non-urgent appointments.');
            }
        }

        // Reschedule non-urgent appointments to make room
        function rescheduleNonUrgent() {
            const nonUrgentScheduled = appointments.filter(apt => 
                apt.priority !== 'urgent' && apt.status === 'scheduled'
            );
            
            if (nonUrgentScheduled.length === 0) {
                alert('No non-urgent appointments to reschedule');
                return;
            }
            
            // Move the furthest non-urgent appointment
            const furthestAppointment = nonUrgentScheduled.reduce((furthest, current) => {
                return new Date(current.scheduledDate) > new Date(furthest.scheduledDate) ? current : furthest;
            });
            
            // Move it 7 days later
            const newDate = new Date(furthestAppointment.scheduledDate);
            newDate.setDate(newDate.getDate() + 7);
            furthestAppointment.scheduledDate = newDate.toISOString();
            
            // Trigger data change notification and global update
            onDataChange('Non-Urgent Patient Rescheduled', {
                patient: furthestAppointment.patientName,
                oldDate: furthestAppointment.scheduledDate,
                newDate: newDate.toLocaleDateString(),
                priority: furthestAppointment.priority
            });
            
            alert(`Rescheduled ${furthestAppointment.patientName} to ${newDate.toLocaleDateString()}`);
        }

        // View waiting list
        function viewWaitingList() {
            filterQueue('waiting');
        }

        // Find next available slot (USA business days only, excluding holidays)
        function findNextAvailableSlot() {
            const today = new Date();
            const nyTime = new Date(today.toLocaleString("en-US", {timeZone: "America/New_York"}));
            
            // Find first available business day slot that's not a holiday (underperformance - need to look further)
            for (let i = 1; i <= 90; i++) { // Increased range due to severe underperformance
                const testDate = new Date(nyTime);
                testDate.setDate(testDate.getDate() + i);
                
                // Skip weekends (Saturday = 6, Sunday = 0) and holidays
                if (testDate.getDay() === 0 || testDate.getDay() === 6 || isHoliday(testDate)) {
                    continue;
                }
                
                // Check if this date has available slots
                const appointmentsOnDate = appointments.filter(apt => {
                    if (!apt.scheduledDate) return false;
                    const aptDate = new Date(apt.scheduledDate).toLocaleString("en-US", {timeZone: "America/New_York"});
                    return new Date(aptDate).toDateString() === testDate.toDateString();
                });
                
                const totalSlots = 18; // 8:00 AM to 4:30 PM in 30-min slots
                const availableSlots = totalSlots - appointmentsOnDate.length;
                
                // If there are available slots, return this date
                if (availableSlots > 0) {
                    return testDate;
                }
            }
            
            return null;
        }

        // Initialize schedule grid with USA working hours (New York timezone)
        function initializeSchedule() {
            const grid = document.getElementById('scheduleGrid');
            
            // USA business hours: Monday-Friday, 8:00 AM - 5:00 PM (New York time)
            const timeSlots = [
                '8:00 AM', '8:30 AM', '9:00 AM', '9:30 AM', '10:00 AM', '10:30 AM', 
                '11:00 AM', '11:30 AM', '12:00 PM', '12:30 PM', '1:00 PM', '1:30 PM', 
                '2:00 PM', '2:30 PM', '3:00 PM', '3:30 PM', '4:00 PM', '4:30 PM'
            ];

            grid.innerHTML = '';
            timeSlots.forEach(slot => {
                const slotElement = document.createElement('div');
                slotElement.className = 'time-slot';
                slotElement.textContent = slot;
                slotElement.onclick = () => selectTimeSlot(slot, slotElement);
                grid.appendChild(slotElement);
            });
            
            // Update schedule grid with current status
            updateScheduleGrid();
            updateCalendarAvailability();
        }

        // Update schedule grid with real-time status
        function updateScheduleGrid() {
            const grid = document.getElementById('scheduleGrid');
            const slots = grid.querySelectorAll('.time-slot');
            
            // Get current time in New York timezone
            const now = new Date();
            const nyTime = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"}));
            const currentHour = nyTime.getHours();
            const currentMinute = nyTime.getMinutes();
            const currentDay = nyTime.getDay(); // 0 = Sunday, 1 = Monday, etc.
            
            // Check if it's a business day (Monday-Friday)
            const isBusinessDay = currentDay >= 1 && currentDay <= 5;
            
            slots.forEach(slot => {
                const timeText = slot.textContent.split('\n')[0]; // Get just the time part
                const [time, period] = timeText.split(' ');
                const [hour, minute] = time.split(':').map(Number);
                
                // Convert to 24-hour format for comparison
                let slotHour = hour;
                if (period === 'PM' && hour !== 12) slotHour += 12;
                if (period === 'AM' && hour === 12) slotHour = 0;
                
                const slotTime = slotHour * 60 + minute;
                const currentTime = currentHour * 60 + currentMinute;
                
                // Reset classes
                slot.className = 'time-slot';
                slot.innerHTML = timeText;
                
                // Check if slot is booked for today
                const today = new Date();
                const appointmentForSlot = appointments.find(apt => {
                    if (!apt.scheduledDate) return false;
                    const aptDate = new Date(apt.scheduledDate);
                    const aptNyTime = new Date(aptDate.toLocaleString("en-US", {timeZone: "America/New_York"}));
                    return aptNyTime.toDateString() === nyTime.toDateString() && apt.time === timeText;
                });
                
                if (!isBusinessDay) {
                    // Weekend - no appointments
                    slot.classList.add('weekend');
                    slot.innerHTML = `
                        <div class="time-slot-status">WEEKEND</div>
                        ${timeText}
                    `;
                } else if (appointmentForSlot) {
                    // Slot is booked
                    slot.classList.add('booked');
                    slot.innerHTML = `
                        <div class="time-slot-status">BOOKED</div>
                        ${timeText}
                        <div class="patient-info">${appointmentForSlot.patientName}</div>
                    `;
                    
                    // Check if it's currently happening
                    if (slotTime === currentTime || (slotTime < currentTime && slotTime + 30 > currentTime)) {
                        slot.classList.remove('booked');
                        slot.classList.add('current');
                        slot.innerHTML = `
                            <div class="time-slot-status">NOW</div>
                            ${timeText}
                            <div class="patient-info">${appointmentForSlot.patientName}</div>
                        `;
                    }
                } else if (slotTime < currentTime) {
                    // Time has passed
                    slot.classList.add('passed');
                    slot.innerHTML = `
                        <div class="time-slot-status">PASSED</div>
                        ${timeText}
                    `;
                } else if (slotTime === currentTime) {
                    // Current time slot
                    slot.classList.add('current');
                    slot.innerHTML = `
                        <div class="time-slot-status">NOW</div>
                        ${timeText}
                    `;
                } else {
                    // Available slot
                    slot.classList.add('available');
                    slot.innerHTML = `
                        <div class="time-slot-status">FREE</div>
                        ${timeText}
                    `;
                }
                
                // Add click handler
                slot.onclick = () => selectTimeSlot(timeText, slot);
            });
        }

        // Generate available date suggestions
        function generateAvailableDateSuggestions() {
            const nyTime = new Date().toLocaleString("en-US", {timeZone: "America/New_York"});
            const currentDate = new Date(nyTime);
            const suggestedDatesList = document.getElementById('suggestedDatesList');
            
            if (!suggestedDatesList) return;
            
            const availableDates = [];
            const totalSlots = 18; // 8:00 AM to 4:30 PM in 30-min slots
            
            // Check next 90 days for available dates (underperformance scenario - need to look further)
            for (let i = 1; i <= 90; i++) {
                const testDate = new Date(currentDate);
                testDate.setDate(testDate.getDate() + i);
                
                // Skip weekends and holidays
                if (testDate.getDay() === 0 || testDate.getDay() === 6 || isHoliday(testDate)) {
                    continue;
                }
                
                // Check available slots for this date
                const appointmentsOnDate = appointments.filter(apt => {
                    if (!apt.scheduledDate) return false;
                    const aptDate = new Date(apt.scheduledDate).toLocaleString("en-US", {timeZone: "America/New_York"});
                    return new Date(aptDate).toDateString() === testDate.toDateString();
                });
                
                const availableSlots = totalSlots - appointmentsOnDate.length;
                
                // Only include dates with available slots (underperformance: fewer options)
                if (availableSlots > 0) {
                    availableDates.push({
                        date: testDate,
                        availableSlots: availableSlots,
                        dateString: testDate.toISOString().split('T')[0]
                    });
                }
                
                // Stop after finding 3 available dates (underperformance: very limited options)
                if (availableDates.length >= 3) break;
            }
            
            // Clear existing suggestions
            suggestedDatesList.innerHTML = '';
            
            if (availableDates.length === 0) {
                suggestedDatesList.innerHTML = '<div class="no-dates-available">üö® No available dates in the next 90 days - Clinic is severely overbooked due to underperformance</div>';
                return;
            }
            
            // Generate suggestion buttons
            availableDates.forEach(dateInfo => {
                const dateButton = document.createElement('div');
                dateButton.className = 'suggested-date';
                dateButton.innerHTML = `
                    <div class="date-info">${dateInfo.date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</div>
                    <div class="date-slots">${dateInfo.availableSlots} slots</div>
                `;
                
                dateButton.onclick = () => {
                    // Remove previous selection
                    document.querySelectorAll('.suggested-date').forEach(btn => btn.classList.remove('selected'));
                    
                    // Select this date
                    dateButton.classList.add('selected');
                    document.getElementById('preferredDate').value = dateInfo.dateString;
                    checkDateAvailability(dateInfo.dateString);
                };
                
                suggestedDatesList.appendChild(dateButton);
            });
        }

        // Update calendar availability for future dates
        function updateCalendarAvailability() {
            const preferredDateInput = document.getElementById('preferredDate');
            if (!preferredDateInput) return;
            
            // Get current date in NY timezone
            const nyTime = new Date().toLocaleString("en-US", {timeZone: "America/New_York"});
            const currentDate = new Date(nyTime);
            
            // Set minimum date to today
            const minDate = currentDate.toISOString().split('T')[0];
            preferredDateInput.min = minDate;
            
            // Set maximum date to 5 years from now
            const maxDate = new Date(currentDate);
            maxDate.setFullYear(maxDate.getFullYear() + 5);
            preferredDateInput.max = maxDate.toISOString().split('T')[0];
            
            // Generate initial date suggestions
            generateAvailableDateSuggestions();
            
            // Add event listener for date changes
            preferredDateInput.addEventListener('change', function() {
                checkDateAvailability(this.value);
            });
            
            // Add event listener for date input to prevent weekend/holiday selection
            preferredDateInput.addEventListener('input', function() {
                const selectedDate = new Date(this.value + 'T00:00:00');
                const dayOfWeek = selectedDate.getDay();
                const isHolidayDate = isHoliday(selectedDate);
                const weekendWarning = document.getElementById('weekendWarning');
                
                // If weekend or holiday is selected, find next business day
                if (dayOfWeek === 0 || dayOfWeek === 6 || isHolidayDate) {
                    let nextBusinessDay = new Date(selectedDate);
                    
                    // Keep advancing until we find a business day that's not a holiday
                    do {
                        nextBusinessDay.setDate(nextBusinessDay.getDate() + 1);
                    } while (nextBusinessDay.getDay() === 0 || nextBusinessDay.getDay() === 6 || isHoliday(nextBusinessDay));
                    
                    this.value = nextBusinessDay.toISOString().split('T')[0];
                    
                    // Show warning with appropriate message
                    if (weekendWarning) {
                        if (isHolidayDate) {
                            weekendWarning.innerHTML = 'Holidays are not available for appointments. The date has been automatically adjusted to the next business day.';
                        } else {
                            weekendWarning.innerHTML = 'Weekends are not available for appointments. The date has been automatically adjusted to the next business day.';
                        }
                        weekendWarning.classList.add('show');
                        setTimeout(() => {
                            weekendWarning.classList.remove('show');
                        }, 5000); // Hide after 5 seconds
                    }
                    
                    checkDateAvailability(this.value);
                } else {
                    // Hide warning if valid business day is selected
                    if (weekendWarning) {
                        weekendWarning.classList.remove('show');
                    }
                }
            });
        }

        // Check if a date is a US federal holiday
        function isHoliday(date) {
            const year = date.getFullYear();
            const month = date.getMonth();
            const day = date.getDate();
            
            // Fixed holidays
            const holidays = [
                { month: 0, day: 1 },   // New Year's Day
                { month: 6, day: 4 },   // Independence Day
                { month: 10, day: 11 }, // Veterans Day
                { month: 11, day: 25 }, // Christmas Day
            ];
            
            // Check fixed holidays
            for (let holiday of holidays) {
                if (month === holiday.month && day === holiday.day) {
                    return true;
                }
            }
            
            // Calculate variable holidays
            // Martin Luther King Jr. Day (3rd Monday in January)
            const mlkDay = getNthWeekday(year, 0, 1, 3); // January, Monday, 3rd
            if (month === 0 && day === mlkDay) return true;
            
            // Presidents' Day (3rd Monday in February)
            const presidentsDay = getNthWeekday(year, 1, 1, 3); // February, Monday, 3rd
            if (month === 1 && day === presidentsDay) return true;
            
            // Memorial Day (Last Monday in May)
            const memorialDay = getLastWeekday(year, 4, 1); // May, Monday, last
            if (month === 4 && day === memorialDay) return true;
            
            // Labor Day (1st Monday in September)
            const laborDay = getNthWeekday(year, 8, 1, 1); // September, Monday, 1st
            if (month === 8 && day === laborDay) return true;
            
            // Columbus Day (2nd Monday in October)
            const columbusDay = getNthWeekday(year, 9, 1, 2); // October, Monday, 2nd
            if (month === 9 && day === columbusDay) return true;
            
            // Thanksgiving (4th Thursday in November)
            const thanksgiving = getNthWeekday(year, 10, 4, 4); // November, Thursday, 4th
            if (month === 10 && day === thanksgiving) return true;
            
            return false;
        }
        
        // Helper function to get nth weekday of a month
        function getNthWeekday(year, month, weekday, n) {
            const firstDay = new Date(year, month, 1);
            const firstWeekday = firstDay.getDay();
            const daysToAdd = (weekday - firstWeekday + 7) % 7 + (n - 1) * 7;
            return 1 + daysToAdd;
        }
        
        // Helper function to get last weekday of a month
        function getLastWeekday(year, month, weekday) {
            const lastDay = new Date(year, month + 1, 0);
            const lastWeekday = lastDay.getDay();
            const daysToSubtract = (lastWeekday - weekday + 7) % 7;
            return lastDay.getDate() - daysToSubtract;
        }

        // Check availability for selected date
        function checkDateAvailability(selectedDate) {
            const nyTime = new Date().toLocaleString("en-US", {timeZone: "America/New_York"});
            const currentDate = new Date(nyTime);
            const selectedDateObj = new Date(selectedDate + 'T00:00:00');
            const isWeekend = selectedDateObj.getDay() === 0 || selectedDateObj.getDay() === 6;
            const isPastDate = selectedDateObj < currentDate;
            const isHolidayDate = isHoliday(selectedDateObj);
            
            // Show availability status
            let statusMessage = '';
            let statusClass = '';
            
            if (isPastDate) {
                statusMessage = '‚ùå Cannot schedule in the past';
                statusClass = 'error';
            } else if (isWeekend) {
                statusMessage = '‚ùå Weekend - Clinic closed';
                statusClass = 'error';
            } else if (isHolidayDate) {
                statusMessage = '‚ùå Holiday - Clinic closed';
                statusClass = 'error';
            } else {
                // Check if date is fully booked
                const appointmentsOnDate = appointments.filter(apt => {
                    if (!apt.scheduledDate) return false;
                    const aptDate = new Date(apt.scheduledDate).toLocaleString("en-US", {timeZone: "America/New_York"});
                    return new Date(aptDate).toDateString() === selectedDateObj.toDateString();
                });
                
                const totalSlots = 18; // 8:00 AM to 4:30 PM in 30-min slots
                const availableSlots = totalSlots - appointmentsOnDate.length;
                
                if (availableSlots === 0) {
                    statusMessage = '‚ùå Schedule is FULL - Please select an available date from suggestions';
                    statusClass = 'error';
                } else if (availableSlots <= 3) {
                    statusMessage = `‚ö†Ô∏è Only ${availableSlots} slots available - Consider other dates`;
                    statusClass = 'warning';
                } else {
                    statusMessage = `‚úÖ ${availableSlots} slots available`;
                    statusClass = 'success';
                }
            }
            
            // Update status display
            let statusDiv = document.getElementById('dateAvailabilityStatus');
            if (!statusDiv) {
                statusDiv = document.createElement('div');
                statusDiv.id = 'dateAvailabilityStatus';
                statusDiv.style.cssText = 'margin-top: 10px; padding: 8px; border-radius: 4px; font-size: 0.9rem; font-weight: 500;';
                preferredDateInput.parentNode.appendChild(statusDiv);
            }
            
            statusDiv.textContent = statusMessage;
            statusDiv.className = statusClass;
            
            // Update status div styling
            statusDiv.style.background = statusClass === 'error' ? '#fee' : 
                                       statusClass === 'warning' ? '#fff3cd' : '#d4edda';
            statusDiv.style.color = statusClass === 'error' ? '#721c24' : 
                                   statusClass === 'warning' ? '#856404' : '#155724';
            statusDiv.style.border = statusClass === 'error' ? '1px solid #f5c6cb' : 
                                    statusClass === 'warning' ? '1px solid #ffeaa7' : '1px solid #c3e6cb';
        }

        // Load sample data
        function loadSampleData() {
            // Comprehensive patient data: 55 patients (25 existing + 30 waiting)
            const today = new Date();
            appointments = [];
            
            // Generate 25 existing appointments (Patients 1-25)
            for (let i = 1; i <= 25; i++) {
                const daysFromNow = Math.floor(Math.random() * 14) + 1; // 1-14 days from now
                const requestDaysAgo = Math.floor(Math.random() * 7) + 1; // 1-7 days ago
                
                // Determine priority (some urgent cases in existing appointments)
                let priority = 'medium';
                if (i <= 3) priority = 'urgent'; // First 3 are urgent
                else if (i <= 8) priority = 'low'; // Some low priority
                
                // Determine status
                let status = 'scheduled';
                if (i <= 2) status = 'in-progress'; // First 2 are in progress
                else if (i <= 5) status = 'completed'; // Some completed
                
                appointments.push({
                    id: i,
                    patientName: `Patient ${i}`,
                    scheduledDate: new Date(today.getTime() + daysFromNow * 24 * 60 * 60 * 1000).toISOString(),
                    requestDate: new Date(today.getTime() - requestDaysAgo * 24 * 60 * 60 * 1000).toISOString(),
                    priority: priority,
                    status: status,
                    notes: `Appointment for Patient ${i}`
                });
            }
            
            // Generate 30 waiting list patients (Patients 26-55)
            for (let i = 26; i <= 55; i++) {
                const requestDaysAgo = Math.floor(Math.random() * 10) + 1; // 1-10 days ago
                
                // Determine priority - 8 urgent cases on waiting list
                let priority = 'medium';
                if (i >= 26 && i <= 33) priority = 'urgent'; // 8 urgent cases (Patients 26-33)
                else if (i >= 34 && i <= 45) priority = 'low'; // Some low priority
                
                appointments.push({
                    id: i,
                    patientName: `Patient ${i}`,
                    scheduledDate: null, // No scheduled date yet
                    requestDate: new Date(today.getTime() - requestDaysAgo * 24 * 60 * 60 * 1000).toISOString(),
                    priority: priority,
                    status: 'waiting',
                    notes: `Waiting list - Patient ${i}`
                });
            }
            
            // Sort appointments by priority and request date
            appointments.sort((a, b) => {
                const priorityOrder = { urgent: 1, medium: 2, low: 3 };
                if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
                    return priorityOrder[a.priority] - priorityOrder[b.priority];
                }
                return new Date(a.requestDate) - new Date(b.requestDate);
            });

            // Create underperformance scenario - heavily booked next 2 weeks
            const timeSlots = [
                '8:00 AM', '8:30 AM', '9:00 AM', '9:30 AM', '10:00 AM', '10:30 AM',
                '11:00 AM', '11:30 AM', '12:00 PM', '12:30 PM', '1:00 PM', '1:30 PM',
                '2:00 PM', '2:30 PM', '3:00 PM', '3:30 PM', '4:00 PM', '4:30 PM'
            ];
            
            // Fill next 21 business days with heavy booking (85-95% capacity - severe underperformance)
            for (let dayOffset = 1; dayOffset <= 21; dayOffset++) {
                const testDate = new Date(today);
                testDate.setDate(testDate.getDate() + dayOffset);
                
                // Skip weekends
                if (testDate.getDay() === 0 || testDate.getDay() === 6) {
                    continue;
                }
                
                // Skip holidays
                if (isHoliday(testDate)) {
                    continue;
                }
                
                // Book 15-17 out of 18 slots (83-94% capacity - severe underperformance)
                const slotsToBook = Math.floor(Math.random() * 3) + 15; // 15-17 slots
                const shuffledSlots = [...timeSlots].sort(() => Math.random() - 0.5);
                
                for (let i = 0; i < slotsToBook; i++) {
                    const appointmentTime = new Date(testDate);
                    const timeSlot = shuffledSlots[i];
                    const timeIndex = timeSlots.indexOf(timeSlot);
                    appointmentTime.setHours(8 + Math.floor(timeIndex / 2), (timeIndex % 2) * 30, 0, 0);
                    
                    appointments.push({
                        id: appointments.length + 1,
                        patientName: `Patient ${26 + appointments.length}`,
                        type: 'follow-up',
                        priority: i < 4 ? 'urgent' : 'normal',
                        status: 'scheduled',
                        provider: doctor,
                        time: timeSlot,
                        scheduledDate: appointmentTime.toISOString(),
                        requestDate: new Date(Date.now() - Math.random() * 14 * 24 * 60 * 60 * 1000).toISOString(),
                        notes: `Underperformance scenario - ${timeSlot}`
                    });
                }
            }

            // Sample feedback
            feedback = [
                { type: 'wait-time', rating: 4, comment: 'Wait time was reasonable today', timestamp: new Date() },
                { type: 'staff', rating: 5, comment: 'Staff was very helpful and professional', timestamp: new Date() },
                { type: 'scheduling', rating: 3, comment: 'Scheduling process could be improved', timestamp: new Date() }
            ];

            updatePatientList();
            updateRecentFeedback();
        }

        // Calculate wait days for an appointment
        function calculateWaitDays(appointment) {
            const today = new Date();
            const scheduledDate = new Date(appointment.scheduledDate);
            const requestDate = new Date(appointment.requestDate);
            
            if (appointment.status === 'completed') {
                return Math.ceil((scheduledDate - requestDate) / (1000 * 60 * 60 * 24));
            } else {
                // For non-completed appointments, calculate from request date to scheduled date
                // This ensures we always get positive wait days
                const waitDays = Math.ceil((scheduledDate - requestDate) / (1000 * 60 * 60 * 24));
                return Math.max(0, waitDays); // Ensure no negative days
            }
        }

        // Get wait days category for styling
        function getWaitDaysCategory(waitDays) {
            if (waitDays <= 3) return 'low';
            if (waitDays <= 7) return 'medium';
            return 'high';
        }

        // Global filter state
        let currentFilter = 'all';

        // Update patient list display with enhanced information
        function updatePatientList() {
            const list = document.getElementById('patientList');
            list.innerHTML = '';

            // Filter appointments based on current filter
            let filteredAppointments = appointments;
            if (currentFilter !== 'all') {
                filteredAppointments = appointments.filter(appointment => {
                    if (currentFilter === 'today') {
                        const today = new Date();
                        const appointmentDate = new Date(appointment.scheduledDate);
                        today.setHours(0, 0, 0, 0);
                        appointmentDate.setHours(0, 0, 0, 0);
                        return appointmentDate.getTime() === today.getTime();
                    }
                    if (currentFilter === 'urgent') return appointment.priority === 'urgent';
                    if (currentFilter === 'waiting') return appointment.status === 'waiting';
                    if (currentFilter === 'scheduled') return appointment.status === 'scheduled';
                    return true;
                });
            }

            // Sort by appointment date (chronological order)
            filteredAppointments.sort((a, b) => {
                const dateA = new Date(a.scheduledDate);
                const dateB = new Date(b.scheduledDate);
                return dateA - dateB; // Chronological order (earliest first)
            });

            filteredAppointments.forEach(appointment => {
                const waitDays = calculateWaitDays(appointment);
                const waitCategory = getWaitDaysCategory(waitDays);
                const scheduledDate = new Date(appointment.scheduledDate);
                const requestDate = new Date(appointment.requestDate);
                
                const item = document.createElement('div');
                item.className = `patient-item ${appointment.priority}-priority`;
                // Determine if appointment is today, past, or future
                const today = new Date();
                const appointmentDate = new Date(scheduledDate);
                appointmentDate.setHours(0, 0, 0, 0);
                today.setHours(0, 0, 0, 0);
                
                let dateStatus = '';
                let dateClass = '';
                if (appointmentDate.getTime() === today.getTime()) {
                    dateStatus = 'TODAY';
                    dateClass = 'today';
                } else if (appointmentDate < today) {
                    dateStatus = 'PAST';
                    dateClass = 'past';
                } else {
                    dateStatus = 'FUTURE';
                    dateClass = 'future';
                }

                item.innerHTML = `
                    <div class="patient-header">
                        <div class="patient-info">
                            <div class="patient-name">${appointment.name}</div>
                            <div class="patient-details">
                                <div><strong>Appointment Date:</strong> ${scheduledDate.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</div>
                                <div><strong>Time:</strong> ${appointment.time}</div>
                                <div><strong>Type:</strong> ${appointment.type}</div>
                                <div><strong>Priority:</strong> ${appointment.priority}</div>
                            </div>
                        </div>
                        <div class="patient-status-section">
                            <span class="patient-status-badge status-${appointment.status}">${appointment.status}</span>
                            <span class="patient-wait-days ${waitCategory}">${Math.max(0, waitDays)} days</span>
                            <span class="date-status-badge ${dateClass}">${dateStatus}</span>
                        </div>
                    </div>
                    <div class="patient-actions">
                        <button class="patient-action-btn" onclick="updatePatientStatus(${appointment.id}, 'in-progress')">Start</button>
                        <button class="patient-action-btn" onclick="updatePatientStatus(${appointment.id}, 'completed')">Complete</button>
                        <button class="patient-action-btn" onclick="reschedulePatient(${appointment.id})">Reschedule</button>
                        <button class="patient-action-btn" onclick="viewPatientDetails(${appointment.id})">Details</button>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // Filter patients function
        function filterPatients(filter) {
            currentFilter = filter;
            
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updatePatientList();
        }

        // Update patient status
        function updatePatientStatus(patientId, newStatus) {
            const appointment = appointments.find(apt => apt.id === patientId);
            if (appointment) {
                appointment.status = newStatus;
                updatePatientList();
                updateDashboard();
                alert(`Patient ${appointment.name} status updated to ${newStatus}`);
            }
        }

        // Reschedule patient
        function reschedulePatient(patientId) {
            const appointment = appointments.find(apt => apt.id === patientId);
            if (appointment) {
                const newDate = prompt(`Reschedule ${appointment.name} to (YYYY-MM-DD):`, 
                    new Date(appointment.scheduledDate).toISOString().split('T')[0]);
                if (newDate) {
                    appointment.scheduledDate = new Date(newDate);
                    updatePatientList();
                    updateDashboard();
                    alert(`${appointment.name} rescheduled to ${newDate}`);
                }
            }
        }

        // View patient details
        function viewPatientDetails(patientId) {
            const appointment = appointments.find(apt => apt.id === patientId);
            if (appointment) {
                const waitDays = calculateWaitDays(appointment);
                const scheduledDate = new Date(appointment.scheduledDate);
                const requestDate = new Date(appointment.requestDate);
                
                // Determine date status
                const today = new Date();
                const appointmentDate = new Date(scheduledDate);
                today.setHours(0, 0, 0, 0);
                appointmentDate.setHours(0, 0, 0, 0);
                
                let dateStatus = '';
                if (appointmentDate.getTime() === today.getTime()) {
                    dateStatus = 'TODAY';
                } else if (appointmentDate < today) {
                    dateStatus = 'PAST APPOINTMENT';
                } else {
                    dateStatus = 'FUTURE APPOINTMENT';
                }
                
                const details = `
Patient Details:
Name: ${appointment.name}
Type: ${appointment.type}
Priority: ${appointment.priority}
Status: ${appointment.status}

APPOINTMENT SCHEDULE:
Date: ${scheduledDate.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
Time: ${appointment.time}
Status: ${dateStatus}
Wait Days: ${Math.max(0, waitDays)}

REQUEST INFO:
Requested: ${requestDate.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
Notes: ${appointment.notes || 'None'}
                `;
                alert(details);
            }
        }

        // Update recent feedback display
        function updateRecentFeedback() {
            const container = document.getElementById('recentFeedback');
            container.innerHTML = '';

            feedback.slice(-5).forEach(item => {
                const feedbackElement = document.createElement('div');
                feedbackElement.className = 'feedback-item';
                feedbackElement.innerHTML = `
                    <strong>${item.type.replace('-', ' ').toUpperCase()}</strong> - ${item.rating}/5 stars<br>
                    <em>${item.comment}</em><br>
                    <small>${item.timestamp.toLocaleDateString()}</small>
                `;
                container.appendChild(feedbackElement);
            });
        }

        // Handle appointment form submission
        document.getElementById('appointmentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const patientName = document.getElementById('patientName').value;
            const patientType = document.getElementById('patientType').value;
            const priority = document.getElementById('priority').value;
            const preferredDate = document.getElementById('preferredDate').value;
            const notes = document.getElementById('notes').value;
            const selectedTime = document.getElementById('selectedTime').value;
            
            // Validate required fields
            if (!patientName || !patientType || !priority || !preferredDate) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Check if it's a business day and not a holiday
            const appointmentDate = new Date(preferredDate);
            const appointmentDay = appointmentDate.getDay();
            const isHolidayDate = isHoliday(appointmentDate);
            
            if (appointmentDay === 0 || appointmentDay === 6 || isHolidayDate) {
                alert('‚ùå Cannot schedule on weekends or holidays. Please select an available date from the suggestions below.');
                return;
            }
            
            // Check if the selected date has available slots
            const appointmentsOnDate = appointments.filter(apt => {
                if (!apt.scheduledDate) return false;
                const aptDate = new Date(apt.scheduledDate).toLocaleString("en-US", {timeZone: "America/New_York"});
                return new Date(aptDate).toDateString() === appointmentDate.toDateString();
            });
            
            const totalSlots = 18; // 8:00 AM to 4:30 PM in 30-min slots
            const availableSlots = totalSlots - appointmentsOnDate.length;
            
            if (availableSlots === 0) {
                alert('‚ùå This date is fully booked. Please select an available date from the suggestions below.');
                return;
            }
            
            // Check if selected time slot is available
            if (selectedTime) {
                const timeSlotBooked = appointmentsOnDate.some(apt => {
                    const aptTime = new Date(apt.scheduledDate).toLocaleTimeString("en-US", {timeZone: "America/New_York", hour: '2-digit', minute: '2-digit', hour12: true});
                    return aptTime === selectedTime;
                });
                
                if (timeSlotBooked) {
                    alert('This time slot is already booked. Please select another time.');
                    return;
                }
            }
            
            const formData = {
                id: appointments.length + 1,
                patientName: patientName,
                type: patientType,
                priority: priority,
                preferredDate: preferredDate,
                notes: notes,
                status: 'scheduled',
                provider: doctor,
                time: selectedTime || '9:00 AM',
                scheduledDate: new Date(preferredDate + ' ' + (selectedTime || '9:00 AM')).toISOString(),
                requestDate: new Date().toISOString()
            };

            appointments.push(formData);
            
            // Trigger data change notification and global update
            onDataChange('New Appointment Scheduled', {
                patient: patientName,
                date: preferredDate,
                priority: priority
            });
            
            // Clear form
            this.reset();
            
            // Show success message
            alert(`Appointment scheduled successfully for ${patientName}!`);
        });

        // Handle feedback form submission
        document.getElementById('feedbackForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const feedbackData = {
                type: document.getElementById('feedbackType').value,
                rating: parseInt(document.getElementById('feedbackRating').value),
                comment: document.getElementById('feedbackComment').value,
                timestamp: new Date()
            };

            feedback.push(feedbackData);
            updateRecentFeedback();
            updateDashboard();
            
            // Clear form
            this.reset();
            
            // Show success message
            alert('Feedback submitted successfully! Thank you for your input.');
        });

        // Calculate average wait days
        function calculateAverageWaitDays() {
            const activeAppointments = appointments.filter(apt => apt.status !== 'completed');
            if (activeAppointments.length === 0) return 0;
            
            const totalWaitDays = activeAppointments.reduce((sum, apt) => {
                return sum + calculateWaitDays(apt);
            }, 0);
            
            return Math.round(totalWaitDays / activeAppointments.length);
        }

        // Main optimization function - Reduce Wait Days
        function reduceWaitDays() {
            // Reduce average wait days by optimizing schedules
            const currentWaitDays = document.getElementById('avgWaitDays');
            const currentWaitDaysDisplay = document.getElementById('currentWaitDays');
            const trendElement = document.getElementById('waitDaysTrend');
            
            let currentDays = parseInt(currentWaitDays.textContent);
            let displayDays = parseInt(currentWaitDaysDisplay.textContent);
            
            // Reduce by 2-3 days through optimization
            const reduction = Math.floor(Math.random() * 2) + 2;
            const newDays = Math.max(3, currentDays - reduction);
            const newDisplayDays = Math.max(3, displayDays - reduction);
            
            currentWaitDays.textContent = newDays;
            currentWaitDaysDisplay.textContent = newDisplayDays;
            
            // Update trend
            trendElement.innerHTML = `<span class="wait-days-improvement">‚Üì ${reduction} days improvement through optimization</span>`;
            
            // Update patient schedules to reflect reduced wait times
            appointments.forEach(appointment => {
                if (appointment.status === 'scheduled' || appointment.status === 'waiting') {
                    const currentWait = calculateWaitDays(appointment);
                    if (currentWait > 7) {
                        // Reduce wait time by moving appointment closer
                        const reductionDays = Math.min(reduction, currentWait - 3);
                        appointment.scheduledDate = new Date(appointment.scheduledDate.getTime() - reductionDays * 24 * 60 * 60 * 1000);
                    }
                }
            });
            
            updatePatientList();
            alert(`Wait days reduced by ${reduction} days! Average wait time now ${newDays} days.`);
        }

        // Optimization functions
        function optimizeSchedule() {
            // Simulate optimization algorithm focused on wait days
            const utilization = document.getElementById('providerUtilization');
            const satisfaction = document.getElementById('patientSatisfaction');
            
            // Increase utilization by 10%
            let currentUtil = parseInt(utilization.textContent);
            utilization.textContent = Math.min(100, currentUtil + 10);
            
            // Improve satisfaction
            let currentSat = parseFloat(satisfaction.textContent);
            satisfaction.textContent = (currentSat + 0.3).toFixed(1);
            
            // Update schedule grid to show optimized slots
            const slots = document.querySelectorAll('.time-slot');
            slots.forEach(slot => {
                if (slot.classList.contains('available')) {
                    slot.classList.remove('available');
                    slot.classList.add('optimized');
                }
            });
            
            alert('Schedule optimized! Utilization improved, focus on reducing wait days.');
        }

        function balanceWorkload() {
            // For single doctor, optimize schedule distribution throughout the day
            const scheduledAppointments = appointments.filter(apt => apt.status === 'scheduled');
            
            // Redistribute appointments more evenly throughout the day
            const timeSlots = ['8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00', '4:30'];
            
            scheduledAppointments.forEach((appointment, index) => {
                appointment.time = timeSlots[index % timeSlots.length];
            });
            
            updatePatientList();
            alert('Dr. Sarah Johnson\'s schedule optimized for better workload distribution throughout the day.');
        }

        // Legacy function removed - now using reduceWaitDays() instead

        function generateReport() {
            const report = `
DR. SARAH JOHNSON'S SCHEDULING REPORT
Generated: ${new Date().toLocaleString()}

KEY METRICS:
- Average Wait Days: ${document.getElementById('avgWaitDays').textContent} days
- Dr. Sarah's Utilization: ${document.getElementById('providerUtilization').textContent}%
- Patient Satisfaction: ${document.getElementById('patientSatisfaction').textContent}/5
- Total Appointments Today: ${document.getElementById('appointmentsToday').textContent}

PATIENT LOAD ANALYSIS:
- Active Patients: ${appointments.filter(apt => apt.status !== 'completed').length}
- Completed Today: ${appointments.filter(apt => apt.status === 'completed').length}
- Scheduled: ${appointments.filter(apt => apt.status === 'scheduled').length}
- Waiting: ${appointments.filter(apt => apt.status === 'waiting').length}

OPTIMIZATION RECOMMENDATIONS:
1. Focus on reducing wait days to target of <7 days
2. Optimize daily schedule distribution for Dr. Sarah
3. Implement priority-based scheduling for urgent cases
4. Use buffer time between appointments for better patient flow
5. Monitor real-time wait days for immediate adjustments

FEEDBACK SUMMARY:
- Recent feedback items: ${feedback.length}
- Average rating: ${(feedback.reduce((sum, f) => sum + f.rating, 0) / feedback.length).toFixed(1)}/5
            `;
            
            alert(report);
        }

        function selectTimeSlot(time, element) {
            if (element.classList.contains('booked')) {
                alert('This time slot is already booked.');
                return;
            }
            
            if (element.classList.contains('weekend')) {
                alert('Cannot schedule appointments on weekends.');
                return;
            }
            
            if (element.classList.contains('passed')) {
                alert('Cannot schedule appointments in the past.');
                return;
            }
            
            // Set the selected time in the form
            const selectedTimeInput = document.getElementById('selectedTime');
            if (selectedTimeInput) {
                selectedTimeInput.value = time;
            }
            
            // Remove previous selection
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            
            // Add selection to current slot
            element.classList.add('selected');
            
            alert(`Time slot ${time} selected for appointment.`);
        }

        function updateDashboard() {
            // Update patient-centric dashboard
            updatePatientCentricDashboard();
            
            // Update analytics dashboard
            updateAnalyticsDashboard();
            
            // Update clinic progress tracking
            updateClinicProgress();
            
            // Update schedule grid
            updateScheduleGrid();
            
            // Update patient queue
            updatePatientQueue();
            
            // Update urgent cases
            updateUrgentCases();
        }

        // Update patient-centric dashboard with animations (Underperformance Scenario)
        function updatePatientCentricDashboard() {
            const avgWaitDays = 12.3; // Fixed underperformance value
            const today = new Date();
            
            // Animate counter for wait days (showing poor performance)
            animateCounter('avgWaitDays', avgWaitDays);
            
            // Animate progress bar (100% = critical over target)
            const progressPercent = 100; // Over target
            animateProgress('waitDaysProgress', progressPercent);
            
            // Update Dr. Sarah's status (overwhelmed)
            const inProgressToday = appointments.filter(apt => {
                const aptDate = new Date(apt.scheduledDate);
                return aptDate.toDateString() === today.toDateString() && apt.status === 'in-progress';
            }).length;
            
            const statusElement = document.getElementById('lastUpdated');
            statusElement.textContent = new Date().toLocaleTimeString();
            
            // Animate doctor status progress (100% = overwhelmed)
            animateProgress('doctorStatusProgress', 100);
            
            // Update today's schedule overview (showing backlog)
            const todayAppointments = appointments.filter(apt => {
                const aptDate = new Date(apt.scheduledDate);
                return aptDate.toDateString() === today.toDateString();
            });
            
            // Simulate underperformance numbers
            document.getElementById('patientsToday').textContent = '8';
            document.getElementById('completedTodayPatient').textContent = '2';
            document.getElementById('inProgressToday').textContent = '1';
            document.getElementById('waitingToday').textContent = '5';
        }

        // Update clinic progress tracking
        function updateClinicProgress() {
            const avgWaitDays = calculateAverageWaitDays();
            const totalAppointments = appointments.length;
            const completedAppointments = appointments.filter(apt => apt.status === 'completed').length;
            const urgentAppointments = appointments.filter(apt => apt.priority === 'urgent').length;
            
            // Update operational performance achievement
            updateOperationalPerformanceAchievement();
            
            // Update progress metrics
            document.getElementById('patientWaitDays').textContent = avgWaitDays;
            
            // Update weekly trends (simulated data based on current performance)
            const weeklyTrends = generateWeeklyTrends(avgWaitDays);
            updateWeeklyChart(weeklyTrends);
            
            // Update achievement status
            updateAchievementStatus();
        }
        
        // Update operational performance achievement dynamically
        function updateOperationalPerformanceAchievement() {
            const currentAvgWaitDays = 12.3; // Fixed underperformance value
            const targetWaitDays = 5.0;
            const baselineWaitDays = 5.0; // Original target baseline
            
            // Calculate wait time increase percentage (underperformance scenario)
            const waitTimeIncrease = ((currentAvgWaitDays - baselineWaitDays) / baselineWaitDays) * 100;
            
            // Update the achievement section
            const waitTimeReductionElement = document.getElementById('waitTimeReduction');
            const currentAvgWaitDaysElement = document.getElementById('currentAvgWaitDays');
            const targetWaitDaysElement = document.getElementById('targetWaitDays');
            const achievementContainer = document.getElementById('operationalPerformanceAchievement');
            
            if (waitTimeReductionElement) {
                waitTimeReductionElement.textContent = `+${waitTimeIncrease.toFixed(0)}%`;
            }
            
            if (currentAvgWaitDaysElement) {
                currentAvgWaitDaysElement.textContent = currentAvgWaitDays.toFixed(1);
            }
            
            if (targetWaitDaysElement) {
                targetWaitDaysElement.textContent = targetWaitDays.toFixed(1);
            }
            
            // Update background color based on performance (good performance scenario)
            if (achievementContainer) {
                if (currentAvgWaitDays <= targetWaitDays) {
                    // Excellent performance - green
                    achievementContainer.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
                } else if (currentAvgWaitDays <= targetWaitDays * 1.2) {
                    // Good performance - light green
                    achievementContainer.style.background = 'linear-gradient(135deg, #2ecc71, #58d68d)';
                } else {
                    // Acceptable performance - blue
                    achievementContainer.style.background = 'linear-gradient(135deg, #3498db, #5dade2)';
                }
            }
        }

        // Generate weekly trends based on current performance (good performance scenario)
        function generateWeeklyTrends(currentAvg) {
            // Underperformance scenario - increasing wait times
            const baseValues = [8.5, 9.2, 10.1, 11.3, 12.0, 12.3, 12.3];
            const adjustment = currentAvg - 12.3; // Adjust from current baseline
            return baseValues.map(val => Math.max(0, val + adjustment));
        }

        // Update weekly chart with new data
        function updateWeeklyChart(trends) {
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const chartContainer = document.getElementById('weeklyChartContainer');
            
            if (!chartContainer) return;
            
            chartContainer.innerHTML = '';
            
            trends.forEach((value, index) => {
                const barHeight = Math.max(20, (value / Math.max(...trends)) * 100);
                const color = value <= 5 ? '#27ae60' : value <= 8 ? '#f39c12' : '#e74c3c';
                
                const barDiv = document.createElement('div');
                barDiv.style.cssText = `
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    height: 120px;
                `;
                
                barDiv.innerHTML = `
                    <div style="
                        width: 30px;
                        height: ${barHeight}px;
                        background: linear-gradient(to top, ${color}, ${color}88);
                        border-radius: 4px 4px 0 0;
                        margin-bottom: 5px;
                        transition: all 0.3s ease;
                    "></div>
                    <div style="font-size: 0.8rem; color: #7f8c8d;">
                        ${days[index]}<br>${value.toFixed(1)}
                    </div>
                `;
                
                chartContainer.appendChild(barDiv);
            });
        }

        // Update achievement status
        function updateAchievementStatus() {
            // Update professional impact summary
            updateProfessionalImpactSummary();
        }
        
        // Update professional impact summary dynamically
        function updateProfessionalImpactSummary() {
            const currentAvgWaitDays = calculateAverageWaitDays();
            const targetWaitDays = 5.0;
            const urgentCases = appointments.filter(apt => apt.priority === 'urgent').length;
            const totalAppointments = appointments.length;
            
            // Calculate metrics (good performance scenario)
            const baselineWaitDays = 12.8;
            const waitTimeReduction = ((baselineWaitDays - currentAvgWaitDays) / baselineWaitDays) * 100;
            const targetAchievement = Math.round((appointments.filter(apt => {
                const waitDays = calculateWaitDays(apt);
                return waitDays <= 7;
            }).length / totalAppointments) * 100);
            
            // Update elements
            const waitTimeImpactElement = document.getElementById('waitTimeImpact');
            const targetAchievementImpactElement = document.getElementById('targetAchievementImpact');
            const urgentCareCoverageImpactElement = document.getElementById('urgentCareCoverageImpact');
            const impactContainer = document.getElementById('professionalImpactSummary');
            
            if (waitTimeImpactElement) {
                waitTimeImpactElement.textContent = `${waitTimeReduction.toFixed(0)}%`;
            }
            
            if (targetAchievementImpactElement) {
                targetAchievementImpactElement.textContent = `${targetAchievement}%`;
            }
            
            if (urgentCareCoverageImpactElement) {
                // Good performance - high urgent coverage
                urgentCareCoverageImpactElement.textContent = '100%';
            }
            
            // Update background color based on performance (good performance scenario)
            if (impactContainer) {
                if (currentAvgWaitDays <= targetWaitDays) {
                    // Excellent performance - dark blue
                    impactContainer.style.background = 'linear-gradient(135deg, #2c3e50, #34495e)';
                } else if (currentAvgWaitDays <= targetWaitDays * 1.2) {
                    // Good performance - green
                    impactContainer.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
                } else {
                    // Acceptable performance - blue
                    impactContainer.style.background = 'linear-gradient(135deg, #3498db, #5dade2)';
                }
            }
        }

        // Update analytics dashboard with real-time data
        function updateAnalyticsDashboard() {
            const today = new Date();
            const todayAppointments = appointments.filter(apt => {
                const aptDate = new Date(apt.scheduledDate);
                return aptDate.toDateString() === today.toDateString();
            }).length;
            
            const avgWaitDays = calculateAverageWaitDays();
            const activePatients = appointments.filter(apt => apt.status !== 'completed').length;
            const completedToday = appointments.filter(apt => apt.status === 'completed').length;
            const scheduledCount = appointments.filter(apt => apt.status === 'scheduled').length;
            const waitingCount = appointments.filter(apt => apt.status === 'waiting').length;
            const urgentCount = appointments.filter(apt => apt.priority === 'urgent').length;
            
            // Calculate next available slot
            const futureAppointments = appointments.filter(apt => {
                const aptDate = new Date(apt.scheduledDate);
                return aptDate > today && apt.status === 'scheduled';
            });
            const nextAvailable = futureAppointments.length > 0 ? 
                Math.min(...futureAppointments.map(apt => calculateWaitDays(apt))) : 0;
            
            // Update analytics cards
            document.getElementById('todayAppointments').textContent = todayAppointments;
            document.getElementById('avgWaitDaysAnalytics').textContent = avgWaitDays;
            document.getElementById('utilizationAnalytics').textContent = '78%'; // Static for now
            document.getElementById('nextAvailable').textContent = nextAvailable;
            
            // Update patient load summary
            document.getElementById('activePatients').textContent = activePatients;
            document.getElementById('completedToday').textContent = completedToday;
            document.getElementById('scheduledCount').textContent = scheduledCount;
            document.getElementById('waitingCount').textContent = waitingCount;
            document.getElementById('urgentCount').textContent = urgentCount;
            document.getElementById('avgWaitDaysSummary').textContent = avgWaitDays;
            
            // Update insights based on current data
            updateScheduleInsights();
        }

        // Update schedule insights based on current data
        function updateScheduleInsights() {
            const avgWaitDays = calculateAverageWaitDays();
            const urgentCount = appointments.filter(apt => apt.priority === 'urgent').length;
            const todayAppointments = appointments.filter(apt => {
                const aptDate = new Date(apt.scheduledDate);
                return aptDate.toDateString() === new Date().toDateString();
            }).length;
            
            // Update insights dynamically
            const insight1 = document.getElementById('insight1');
            const insight2 = document.getElementById('insight2');
            const insight3 = document.getElementById('insight3');
            const insight4 = document.getElementById('insight4');
            
            if (avgWaitDays <= 7) {
                insight1.innerHTML = `‚úÖ Target achieved: Average wait time is ${avgWaitDays} days (‚â§7 days)`;
                insight1.style.borderLeftColor = '#28a745';
            } else {
                insight1.innerHTML = `‚ö†Ô∏è Target missed: Average wait time is ${avgWaitDays} days (target: ‚â§7 days)`;
                insight1.style.borderLeftColor = '#ffc107';
            }
            
            if (urgentCount > 0) {
                insight2.innerHTML = `üö® ${urgentCount} urgent case(s) requiring immediate attention`;
                insight2.style.borderLeftColor = '#dc3545';
            } else {
                insight2.innerHTML = `‚úÖ No urgent cases pending - good schedule management`;
                insight2.style.borderLeftColor = '#28a745';
            }
            
            insight3.innerHTML = `üìà Peak utilization at 9:00 AM (95%) - consider adding morning slots`;
            insight4.innerHTML = `üïê Low utilization at 4:00 PM (70%) - opportunity for afternoon optimization`;
        }

        function startRealTimeUpdates() {
            // Update schedule grid every minute for real-time status
            setInterval(() => {
                updateScheduleGrid();
            }, 60000); // Every minute
            
            // Simulate real-time updates every 10 seconds for maximum responsiveness
            setInterval(() => {
                // Simulate patient status changes
                appointments.forEach(appointment => {
                    if (appointment.status === 'waiting' && Math.random() > 0.7) {
                        appointment.status = 'in-progress';
                    } else if (appointment.status === 'in-progress' && Math.random() > 0.8) {
                        appointment.status = 'completed';
                    }
                });
                
                // Trigger global update - ALL components refresh simultaneously
                triggerGlobalUpdate();
            }, 10000); // Every 10 seconds for maximum responsiveness
            
            // Update performance metrics every 5 seconds
            setInterval(() => {
                updatePerformanceMetrics();
            }, 5000); // Every 5 seconds
            
            // Update calendar availability every 15 seconds
            setInterval(() => {
                updateCalendarAvailability();
                generateAvailableDateSuggestions();
            }, 15000); // Every 15 seconds
        }

        // Utility functions
        function formatTime(date) {
            return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        function formatDate(date) {
            return date.toLocaleDateString();
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'o':
                        e.preventDefault();
                        optimizeSchedule();
                        break;
                    case 'b':
                        e.preventDefault();
                        balanceWorkload();
                        break;
                    case 'r':
                        e.preventDefault();
                        generateReport();
                        break;
                }
            }
        });

        // Debug: Check for Firebase initialization
        console.log('Checking for Firebase...');
        if (typeof firebase !== 'undefined') {
            console.log('Firebase is loaded:', firebase);
        } else {
            console.log('Firebase is not loaded');
        }
        
        // Service worker removed to prevent Firebase initialization errors
    </script>
</body>
</html>
