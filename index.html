<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cancer Clinic Scheduling Optimization System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .header p {
            text-align: center;
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .scheduling-interface {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .time-slot {
            background: #ecf0f1;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .time-slot:hover {
            background: #d5dbdb;
            transform: scale(1.02);
        }

        .time-slot.booked {
            background: #e74c3c;
            color: white;
            cursor: not-allowed;
        }

        .time-slot.available {
            background: #27ae60;
            color: white;
        }

        .time-slot.optimized {
            background: #3498db;
            color: white;
        }

        .patient-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .patient-item {
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .patient-wait-days {
            background: #e74c3c;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }

        .patient-wait-days.low {
            background: #27ae60;
        }

        .patient-wait-days.medium {
            background: #f39c12;
        }

        .patient-wait-days.high {
            background: #e74c3c;
        }

        .patient-item.high-priority {
            border-left-color: #e74c3c;
            background: #fdf2f2;
        }

        .patient-item.medium-priority {
            border-left-color: #f39c12;
            background: #fef9e7;
        }

        .feedback-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .feedback-form {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .feedback-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .optimization-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-available { background: #27ae60; }
        .status-booked { background: #e74c3c; }
        .status-optimized { background: #3498db; }

        .wait-time-display {
            background: linear-gradient(135deg, #ff7675, #fd79a8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(255, 118, 117, 0.3);
        }

        .wait-time-value {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .wait-days-display {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
            border: 3px solid rgba(255, 255, 255, 0.2);
        }

        .wait-days-value {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .wait-days-label {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .wait-days-trend {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .wait-days-improvement {
            color: #2ecc71;
            font-weight: bold;
        }

        .wait-days-warning {
            color: #f39c12;
            font-weight: bold;
        }

        .analytics-chart {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .chart-bar {
            background: #3498db;
            height: 20px;
            margin-bottom: 10px;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        @media (max-width: 768px) {
            .dashboard,
            .scheduling-interface,
            .feedback-section {
                grid-template-columns: 1fr;
            }
            
            .schedule-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üè• Cancer Clinic Scheduling Optimization</h1>
            <p>Reducing wait times ‚Ä¢ Maximizing provider utilization ‚Ä¢ Improving patient experience</p>
        </div>

        <!-- Key Metrics Dashboard -->
        <div class="dashboard">
            <div class="card">
                <h2>üìä Current Performance Metrics</h2>
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-value" id="avgWaitDays">12</div>
                        <div class="metric-label">Avg Wait Days</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="avgWaitTime">24</div>
                        <div class="metric-label">Avg Wait Time (min)</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="providerUtilization">78</div>
                        <div class="metric-label">Provider Utilization (%)</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="patientSatisfaction">4.2</div>
                        <div class="metric-label">Patient Satisfaction</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="appointmentsToday">47</div>
                        <div class="metric-label">Appointments Today</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üìÖ Patient Wait Days Monitor</h2>
                <div class="wait-days-display">
                    <div class="wait-days-value" id="currentWaitDays">12</div>
                    <div class="wait-days-label">Average Days Until Provider Visit</div>
                    <div class="wait-days-trend" id="waitDaysTrend">
                        <span class="wait-days-improvement">‚Üì 2 days improvement this week</span>
                    </div>
                </div>
                <div class="status-indicator status-available"></div>
                <span>Target: &lt; 7 days | Current: 12 days</span>
            </div>
        </div>

        <!-- Scheduling Interface -->
        <div class="scheduling-interface">
            <div class="card">
                <h2>üìÖ Schedule New Appointment</h2>
                <form id="appointmentForm">
                    <div class="form-group">
                        <label for="patientName">Patient Name</label>
                        <input type="text" id="patientName" required>
                    </div>
                    <div class="form-group">
                        <label for="patientType">Appointment Type</label>
                        <select id="patientType" required>
                            <option value="">Select Type</option>
                            <option value="consultation">Initial Consultation</option>
                            <option value="followup">Follow-up</option>
                            <option value="treatment">Treatment</option>
                            <option value="urgent">Urgent Care</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="priority">Priority Level</label>
                        <select id="priority" required>
                            <option value="low">Low Priority</option>
                            <option value="medium">Medium Priority</option>
                            <option value="high">High Priority</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="preferredDate">Preferred Date</label>
                        <input type="date" id="preferredDate" required>
                    </div>
                    <div class="form-group">
                        <label for="notes">Special Notes</label>
                        <textarea id="notes" rows="3" placeholder="Any special requirements or notes..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">Schedule Appointment</button>
                </form>
            </div>

            <div class="card">
                <h2>üîß Optimization Controls</h2>
                <div class="optimization-controls">
                    <button class="btn" onclick="reduceWaitDays()">üìÖ Reduce Wait Days</button>
                    <button class="btn btn-warning" onclick="optimizeSchedule()">üöÄ Optimize Schedule</button>
                    <button class="btn btn-success" onclick="balanceWorkload()">‚öñÔ∏è Balance Workload</button>
                    <button class="btn" onclick="generateReport()">üìà Generate Report</button>
                </div>
                
                <h3>Today's Schedule Overview</h3>
                <div class="schedule-grid" id="scheduleGrid">
                    <!-- Schedule slots will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Patient Queue Management -->
        <div class="dashboard">
            <div class="card">
                <h2>üë• Current Patient Queue</h2>
                <div class="patient-list" id="patientList">
                    <!-- Patient items will be populated by JavaScript -->
                </div>
            </div>

            <div class="card">
                <h2>üìà Scheduling Analytics</h2>
                <div class="analytics-chart">
                    <h4>Provider Utilization by Hour</h4>
                    <div class="chart-bar" style="width: 85%;">8:00 AM - 85%</div>
                    <div class="chart-bar" style="width: 95%;">9:00 AM - 95%</div>
                    <div class="chart-bar" style="width: 78%;">10:00 AM - 78%</div>
                    <div class="chart-bar" style="width: 92%;">11:00 AM - 92%</div>
                    <div class="chart-bar" style="width: 88%;">1:00 PM - 88%</div>
                    <div class="chart-bar" style="width: 76%;">2:00 PM - 76%</div>
                    <div class="chart-bar" style="width: 82%;">3:00 PM - 82%</div>
                    <div class="chart-bar" style="width: 70%;">4:00 PM - 70%</div>
                </div>
            </div>
        </div>

        <!-- Feedback System -->
        <div class="feedback-section">
            <div class="feedback-form">
                <h2>üí¨ Patient Feedback</h2>
                <form id="feedbackForm">
                    <div class="form-group">
                        <label for="feedbackType">Feedback Type</label>
                        <select id="feedbackType" required>
                            <option value="">Select Type</option>
                            <option value="wait-time">Wait Time</option>
                            <option value="staff">Staff Experience</option>
                            <option value="scheduling">Scheduling Process</option>
                            <option value="facility">Facility</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="feedbackRating">Rating (1-5)</label>
                        <select id="feedbackRating" required>
                            <option value="">Select Rating</option>
                            <option value="1">1 - Poor</option>
                            <option value="2">2 - Fair</option>
                            <option value="3">3 - Good</option>
                            <option value="4">4 - Very Good</option>
                            <option value="5">5 - Excellent</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="feedbackComment">Comments</label>
                        <textarea id="feedbackComment" rows="4" placeholder="Please share your experience..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">Submit Feedback</button>
                </form>
            </div>

            <div class="feedback-form">
                <h2>üìã Recent Feedback</h2>
                <div id="recentFeedback">
                    <!-- Feedback items will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Prevent Firebase initialization
        window.firebase = undefined;
        console.log('Firebase blocked from initialization');
        
        // Global state management
        let appointments = [];
        let feedback = [];
        let schedule = {};
        let providers = ['Dr. Smith', 'Dr. Johnson', 'Dr. Williams', 'Dr. Brown'];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeSchedule();
            loadSampleData();
            updateDashboard();
            startRealTimeUpdates();
        });

        // Initialize schedule grid
        function initializeSchedule() {
            const grid = document.getElementById('scheduleGrid');
            const timeSlots = [
                '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30',
                '1:00', '1:30', '2:00', '2:30', '3:00', '3:30', '4:00', '4:30'
            ];

            grid.innerHTML = '';
            timeSlots.forEach(slot => {
                const slotElement = document.createElement('div');
                slotElement.className = 'time-slot available';
                slotElement.textContent = slot;
                slotElement.onclick = () => selectTimeSlot(slot, slotElement);
                grid.appendChild(slotElement);
            });
        }

        // Load sample data
        function loadSampleData() {
            // Sample appointments with wait days calculation
            const today = new Date();
            appointments = [
                { 
                    id: 1, 
                    name: 'John Doe', 
                    type: 'consultation', 
                    priority: 'high', 
                    time: '9:00', 
                    provider: 'Dr. Smith', 
                    status: 'scheduled',
                    scheduledDate: new Date(today.getTime() + 5 * 24 * 60 * 60 * 1000), // 5 days from now
                    requestDate: today
                },
                { 
                    id: 2, 
                    name: 'Jane Smith', 
                    type: 'followup', 
                    priority: 'medium', 
                    time: '10:30', 
                    provider: 'Dr. Johnson', 
                    status: 'waiting',
                    scheduledDate: new Date(today.getTime() + 8 * 24 * 60 * 60 * 1000), // 8 days from now
                    requestDate: new Date(today.getTime() - 2 * 24 * 60 * 60 * 1000) // 2 days ago
                },
                { 
                    id: 3, 
                    name: 'Bob Wilson', 
                    type: 'treatment', 
                    priority: 'low', 
                    time: '2:00', 
                    provider: 'Dr. Williams', 
                    status: 'completed',
                    scheduledDate: today,
                    requestDate: new Date(today.getTime() - 15 * 24 * 60 * 60 * 1000) // 15 days ago
                },
                { 
                    id: 4, 
                    name: 'Alice Brown', 
                    type: 'urgent', 
                    priority: 'urgent', 
                    time: '11:00', 
                    provider: 'Dr. Brown', 
                    status: 'in-progress',
                    scheduledDate: new Date(today.getTime() + 1 * 24 * 60 * 60 * 1000), // 1 day from now
                    requestDate: new Date(today.getTime() - 1 * 24 * 60 * 60 * 1000) // 1 day ago
                }
            ];

            // Sample feedback
            feedback = [
                { type: 'wait-time', rating: 4, comment: 'Wait time was reasonable today', timestamp: new Date() },
                { type: 'staff', rating: 5, comment: 'Staff was very helpful and professional', timestamp: new Date() },
                { type: 'scheduling', rating: 3, comment: 'Scheduling process could be improved', timestamp: new Date() }
            ];

            updatePatientList();
            updateRecentFeedback();
        }

        // Calculate wait days for an appointment
        function calculateWaitDays(appointment) {
            const today = new Date();
            const scheduledDate = new Date(appointment.scheduledDate);
            const requestDate = new Date(appointment.requestDate);
            
            if (appointment.status === 'completed') {
                return Math.ceil((scheduledDate - requestDate) / (1000 * 60 * 60 * 24));
            } else {
                return Math.ceil((scheduledDate - today) / (1000 * 60 * 60 * 24));
            }
        }

        // Get wait days category for styling
        function getWaitDaysCategory(waitDays) {
            if (waitDays <= 3) return 'low';
            if (waitDays <= 7) return 'medium';
            return 'high';
        }

        // Update patient list display
        function updatePatientList() {
            const list = document.getElementById('patientList');
            list.innerHTML = '';

            appointments.forEach(appointment => {
                const waitDays = calculateWaitDays(appointment);
                const waitCategory = getWaitDaysCategory(waitDays);
                
                const item = document.createElement('div');
                item.className = `patient-item ${appointment.priority}-priority`;
                item.innerHTML = `
                    <div>
                        <strong>${appointment.name}</strong><br>
                        <small>${appointment.type} ‚Ä¢ ${appointment.time} ‚Ä¢ ${appointment.provider}</small>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <span class="status-indicator status-${appointment.status === 'waiting' ? 'booked' : 'available'}"></span>
                        ${appointment.status}
                        <span class="patient-wait-days ${waitCategory}">${waitDays} days</span>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // Update recent feedback display
        function updateRecentFeedback() {
            const container = document.getElementById('recentFeedback');
            container.innerHTML = '';

            feedback.slice(-5).forEach(item => {
                const feedbackElement = document.createElement('div');
                feedbackElement.className = 'feedback-item';
                feedbackElement.innerHTML = `
                    <strong>${item.type.replace('-', ' ').toUpperCase()}</strong> - ${item.rating}/5 stars<br>
                    <em>${item.comment}</em><br>
                    <small>${item.timestamp.toLocaleDateString()}</small>
                `;
                container.appendChild(feedbackElement);
            });
        }

        // Handle appointment form submission
        document.getElementById('appointmentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                id: appointments.length + 1,
                name: document.getElementById('patientName').value,
                type: document.getElementById('patientType').value,
                priority: document.getElementById('priority').value,
                date: document.getElementById('preferredDate').value,
                notes: document.getElementById('notes').value,
                status: 'scheduled',
                provider: providers[Math.floor(Math.random() * providers.length)],
                requestDate: new Date(),
                scheduledDate: new Date(document.getElementById('preferredDate').value)
            };

            appointments.push(formData);
            updatePatientList();
            updateDashboard();
            
            // Clear form
            this.reset();
            
            // Show success message
            alert('Appointment scheduled successfully!');
        });

        // Handle feedback form submission
        document.getElementById('feedbackForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const feedbackData = {
                type: document.getElementById('feedbackType').value,
                rating: parseInt(document.getElementById('feedbackRating').value),
                comment: document.getElementById('feedbackComment').value,
                timestamp: new Date()
            };

            feedback.push(feedbackData);
            updateRecentFeedback();
            updateDashboard();
            
            // Clear form
            this.reset();
            
            // Show success message
            alert('Feedback submitted successfully! Thank you for your input.');
        });

        // Calculate average wait days
        function calculateAverageWaitDays() {
            const activeAppointments = appointments.filter(apt => apt.status !== 'completed');
            if (activeAppointments.length === 0) return 0;
            
            const totalWaitDays = activeAppointments.reduce((sum, apt) => {
                return sum + calculateWaitDays(apt);
            }, 0);
            
            return Math.round(totalWaitDays / activeAppointments.length);
        }

        // Main optimization function - Reduce Wait Days
        function reduceWaitDays() {
            // Reduce average wait days by optimizing schedules
            const currentWaitDays = document.getElementById('avgWaitDays');
            const currentWaitDaysDisplay = document.getElementById('currentWaitDays');
            const trendElement = document.getElementById('waitDaysTrend');
            
            let currentDays = parseInt(currentWaitDays.textContent);
            let displayDays = parseInt(currentWaitDaysDisplay.textContent);
            
            // Reduce by 2-3 days through optimization
            const reduction = Math.floor(Math.random() * 2) + 2;
            const newDays = Math.max(3, currentDays - reduction);
            const newDisplayDays = Math.max(3, displayDays - reduction);
            
            currentWaitDays.textContent = newDays;
            currentWaitDaysDisplay.textContent = newDisplayDays;
            
            // Update trend
            trendElement.innerHTML = `<span class="wait-days-improvement">‚Üì ${reduction} days improvement through optimization</span>`;
            
            // Update patient schedules to reflect reduced wait times
            appointments.forEach(appointment => {
                if (appointment.status === 'scheduled' || appointment.status === 'waiting') {
                    const currentWait = calculateWaitDays(appointment);
                    if (currentWait > 7) {
                        // Reduce wait time by moving appointment closer
                        const reductionDays = Math.min(reduction, currentWait - 3);
                        appointment.scheduledDate = new Date(appointment.scheduledDate.getTime() - reductionDays * 24 * 60 * 60 * 1000);
                    }
                }
            });
            
            updatePatientList();
            alert(`Wait days reduced by ${reduction} days! Average wait time now ${newDays} days.`);
        }

        // Optimization functions
        function optimizeSchedule() {
            // Simulate optimization algorithm
            const waitTime = document.getElementById('avgWaitTime');
            const utilization = document.getElementById('providerUtilization');
            const satisfaction = document.getElementById('patientSatisfaction');
            
            // Reduce wait time by 30%
            let currentWait = parseInt(waitTime.textContent);
            waitTime.textContent = Math.max(5, Math.floor(currentWait * 0.7));
            
            // Increase utilization by 10%
            let currentUtil = parseInt(utilization.textContent);
            utilization.textContent = Math.min(100, currentUtil + 10);
            
            // Improve satisfaction
            let currentSat = parseFloat(satisfaction.textContent);
            satisfaction.textContent = (currentSat + 0.3).toFixed(1);
            
            // Update schedule grid to show optimized slots
            const slots = document.querySelectorAll('.time-slot');
            slots.forEach(slot => {
                if (slot.classList.contains('available')) {
                    slot.classList.remove('available');
                    slot.classList.add('optimized');
                }
            });
            
            alert('Schedule optimized! Wait times reduced, utilization improved.');
        }

        function balanceWorkload() {
            // Redistribute appointments across providers
            appointments.forEach(appointment => {
                if (appointment.status === 'scheduled') {
                    appointment.provider = providers[Math.floor(Math.random() * providers.length)];
                }
            });
            
            updatePatientList();
            alert('Workload balanced across all providers.');
        }

        function reduceWaitTimes() {
            // Implement wait time reduction strategies
            const currentWait = document.getElementById('currentWaitTime');
            let wait = parseInt(currentWait.textContent);
            currentWait.textContent = Math.max(5, Math.floor(wait * 0.6));
            
            // Move some patients to optimized slots
            const urgentPatients = appointments.filter(apt => apt.priority === 'urgent');
            urgentPatients.forEach(patient => {
                if (patient.status === 'waiting') {
                    patient.status = 'in-progress';
                }
            });
            
            updatePatientList();
            alert('Wait times reduced through priority optimization!');
        }

        function generateReport() {
            const report = `
CANCER CLINIC SCHEDULING REPORT
Generated: ${new Date().toLocaleString()}

KEY METRICS:
- Average Wait Time: ${document.getElementById('avgWaitTime').textContent} minutes
- Provider Utilization: ${document.getElementById('providerUtilization').textContent}%
- Patient Satisfaction: ${document.getElementById('patientSatisfaction').textContent}/5
- Total Appointments Today: ${document.getElementById('appointmentsToday').textContent}

OPTIMIZATION RECOMMENDATIONS:
1. Implement dynamic scheduling based on patient priority
2. Use buffer time between appointments for urgent cases
3. Optimize provider schedules based on historical data
4. Implement real-time wait time notifications

FEEDBACK SUMMARY:
- Recent feedback items: ${feedback.length}
- Average rating: ${(feedback.reduce((sum, f) => sum + f.rating, 0) / feedback.length).toFixed(1)}/5
            `;
            
            alert(report);
        }

        function selectTimeSlot(time, element) {
            if (element.classList.contains('booked')) {
                alert('This time slot is already booked.');
                return;
            }
            
            // Toggle selection
            element.classList.toggle('optimized');
            alert(`Time slot ${time} selected for optimization.`);
        }

        function updateDashboard() {
            // Update metrics based on current data
            const totalAppointments = appointments.length;
            const completedAppointments = appointments.filter(apt => apt.status === 'completed').length;
            const waitingAppointments = appointments.filter(apt => apt.status === 'waiting').length;
            
            // Calculate average wait days
            const avgWaitDays = calculateAverageWaitDays();
            document.getElementById('avgWaitDays').textContent = avgWaitDays;
            document.getElementById('currentWaitDays').textContent = avgWaitDays;
            
            // Calculate average wait time based on waiting patients
            const avgWaitTime = waitingAppointments > 0 ? Math.floor(Math.random() * 30) + 10 : 5;
            document.getElementById('avgWaitTime').textContent = avgWaitTime;
            
            // Update current wait time
            document.getElementById('currentWaitTime').textContent = Math.floor(Math.random() * 20) + 5;
            
            // Update appointments today
            document.getElementById('appointmentsToday').textContent = totalAppointments;
            
            // Update wait days trend
            const trendElement = document.getElementById('waitDaysTrend');
            if (avgWaitDays <= 7) {
                trendElement.innerHTML = `<span class="wait-days-improvement">‚úì Target achieved: ‚â§7 days</span>`;
            } else if (avgWaitDays <= 10) {
                trendElement.innerHTML = `<span class="wait-days-warning">‚ö† Close to target: ${avgWaitDays} days</span>`;
            } else {
                trendElement.innerHTML = `<span style="color: #e74c3c; font-weight: bold;">‚ö† Needs attention: ${avgWaitDays} days</span>`;
            }
        }

        function startRealTimeUpdates() {
            // Simulate real-time updates every 30 seconds
            setInterval(() => {
                updateDashboard();
                
                // Simulate patient status changes
                appointments.forEach(appointment => {
                    if (appointment.status === 'waiting' && Math.random() > 0.7) {
                        appointment.status = 'in-progress';
                    } else if (appointment.status === 'in-progress' && Math.random() > 0.8) {
                        appointment.status = 'completed';
                    }
                });
                
                updatePatientList();
            }, 30000);
        }

        // Utility functions
        function formatTime(date) {
            return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        function formatDate(date) {
            return date.toLocaleDateString();
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'o':
                        e.preventDefault();
                        optimizeSchedule();
                        break;
                    case 'b':
                        e.preventDefault();
                        balanceWorkload();
                        break;
                    case 'r':
                        e.preventDefault();
                        generateReport();
                        break;
                }
            }
        });

        // Debug: Check for Firebase initialization
        console.log('Checking for Firebase...');
        if (typeof firebase !== 'undefined') {
            console.log('Firebase is loaded:', firebase);
        } else {
            console.log('Firebase is not loaded');
        }
        
        // Service worker removed to prevent Firebase initialization errors
    </script>
</body>
</html>
